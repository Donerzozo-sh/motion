<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title id="web-title">çµæ„ŸçŸ©é˜µ | è®¾è®¡ä½œå“é›†</title>
    <!-- å¼•å…¥ Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* ç»Ÿä¸€ä½¿ç”¨ Helvetica Now Display å­—ä½“ï¼Œå¹¶æä¾›ç³»ç»Ÿå›é€€ */
        body {
            font-family: 'Helvetica Now Display', 'Inter', system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, "Noto Sans", sans-serif, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol", "Noto Color Emoji";
            /* éšè—æ»šåŠ¨æ¡ï¼Œæ‰“é€ åº”ç”¨æ„Ÿ */
            overflow: hidden;
            /* ç§»é™¤é¡¶éƒ¨å¡«å……ï¼Œå®ç°å…¨å±æ„Ÿ */
            padding-top: 0; 
            background-color: #000;
            min-height: 100vh;
        }

        .grid-item {
            /* å…³é”®ï¼šä¸º transform, opacity å’Œ filter æ·»åŠ è¿‡æ¸¡æ•ˆæœï¼Œä½¿å…¶å¹³æ»‘
              ä½¿ç”¨ cubic-bezier æ›²çº¿ä½¿åŠ¨ç”»æ„Ÿè§‰æ›´è‡ªç„¶ 
            */
            transition: transform 0.25s cubic-bezier(0.4, 0, 0.2, 1), 
                        opacity 0.25s cubic-bezier(0.4, 0, 0.2, 1);
            
            /* æå‡æ€§èƒ½ï¼šå‘Šè¯‰æµè§ˆå™¨è¿™ä¸ªå…ƒç´ çš„ transform å±æ€§å°†ä¼šæ”¹å˜ */
            will-change: transform, opacity, filter;
            
            /* è®¾ç½®ä¸€ä¸ªåŸºç¡€çš„ä¸é€æ˜åº¦ */
            opacity: 0.7;
        }

        #grid-container {
            /* è®¾ç½®ä¸€ä¸ªå¤§äºè§†çª—çš„å›ºå®šå°ºå¯¸ */
            width: 140vw;
            height: 140vh;
        }

        /* è‡ªå®šä¹‰æ»šåŠ¨æ¡æ ·å¼ï¼Œä½¿å…¶ä¸é‚£ä¹ˆçªå…€ */
        ::-webkit-scrollbar {
            width: 5px;
            height: 5px;
        }
        ::-webkit-scrollbar-thumb {
            background-color: rgba(255, 255, 255, 0.2);
            border-radius: 10px;
        }
        ::-webkit-scrollbar-track {
            background: transparent;
        }
        
        /* éšè—åŸç”Ÿé¢œè‰²é€‰æ‹©å™¨çš„è¾“å…¥æ¡† */
        input[type="color"]::-webkit-color-swatch-wrapper {
            padding: 0;
        }
        input[type="color"]::-webkit-color-swatch {
            border: none;
            border-radius: 6px; /* ä¸ Tailwind rounded-lg åŒ¹é… */
        }
    </style>
    <!-- å¼•å…¥ Firebase SDK (éœ€è¦ Firestore å’Œ Auth) -->
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getAuth, signInAnonymously, signInWithCustomToken, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        import { getFirestore, doc, setDoc, onSnapshot, collection, query, getDocs, setLogLevel } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";

        // ======================================================================
        // ** ã€ğŸ”¥ğŸ”¥ğŸ”¥ å…³é”®ä¿®å¤åŒºåŸŸï¼šæ‰‹åŠ¨é…ç½® Firebase Firestoe ğŸ”¥ğŸ”¥ğŸ”¥ã€‘ **
        // ======================================================================
        
        // 1. åº”ç”¨ ID (ä¿æŒä¸å˜æˆ–ä½¿ç”¨æ‚¨çš„çœŸå®é¡¹ç›®ID)
        // è¿™ä¸ª ID ç”¨äºæ„å»º Firestore è·¯å¾„ï¼š/artifacts/{appId}/public/data/...
        const appId = 'default-app-id'; // å»ºè®®å°†å…¶æ›¿æ¢ä¸ºæ‚¨çš„ Firebase é¡¹ç›® ID (e.g. your-project-name)

        // 2. Firebase é…ç½®å¯¹è±¡ (å¿…é¡»æ›¿æ¢ä¸ºæ‚¨çš„çœŸå®é…ç½® JSON)
        // è¯·åœ¨æ‚¨çš„ Firebase æ§åˆ¶å° -> é¡¹ç›®è®¾ç½® -> æ‚¨çš„åº”ç”¨ (Web) ä¸­è·å–æ­¤é…ç½®
        const firebaseConfig = {
            apiKey: "YOUR_REAL_API_KEY_HERE",            // <-- æ›¿æ¢æ­¤è¡Œ
            authDomain: "YOUR_PROJECT_ID.firebaseapp.com", // <-- æ›¿æ¢æ­¤è¡Œ
            projectId: "YOUR_PROJECT_ID",                  // <-- æ›¿æ¢æ­¤è¡Œ
            storageBucket: "YOUR_PROJECT_ID.appspot.com",  // <-- æ›¿æ¢æ­¤è¡Œ
            messagingSenderId: "YOUR_MESSAGING_SENDER_ID", // <-- æ›¿æ¢æ­¤è¡Œ
            appId: "YOUR_APP_ID",                          // <-- æ›¿æ¢æ­¤è¡Œ
        };
        
        // 3. åˆå§‹èº«ä»½éªŒè¯ä»¤ç‰Œ (åœ¨ GitHub Pages ç¯å¢ƒä¸­æ— æ•ˆï¼Œä½¿ç”¨ null å¼ºåˆ¶åŒ¿åç™»å½•)
        const initialAuthToken = null; 
        
        // ======================================================================
        // ** ä¿®å¤é…ç½®ç»“æŸ **
        // ======================================================================

        // --- Firebase & State Variables ---
        let db, auth; 
        let isLocalMode = false; // æœ¬åœ°æ¨¡å¼æ ‡å¿—

        // --- DOM å…ƒç´ å£°æ˜ (åˆå§‹åŒ–ä¸º nullï¼Œåœ¨ setupDOMAndListeners ä¸­èµ‹å€¼) ---
        let gridContainer, modal, videoPlayer, closeModal, mainTitleEl, subTextEl;
        let editContainer, contentDisplay, editTitleEl, editSubtitleEl, topContentArea;
        let editWebTitleEl, editTitleSizeEl, editTitleWeightEl, editTitleColorPickerEl, editTitleSpacingEl;
        let editSubtitleSizeEl, editSubtitleWeightEl, editSubtitleColorPickerEl, editSubtitleSpacingEl;
        let adminToggleBtn, itemEditModal, itemEditIdEl, editImageUrlEl, editVideoUrlEl;
        let authModal, authUsernameEl, authPasswordEl, authErrorMessageEl;


        // --- é…ç½®/çŠ¶æ€å˜é‡ ---
        const NUM_COLS = 14; 
        const NUM_ROWS = 10; 
        const TOTAL_ITEMS = NUM_COLS * NUM_ROWS;
        const MAX_SCALE = 3.0; 
        const MIN_SCALE = 0.175; 
        const EFFECT_RADIUS = 150; 
        const PLACEHOLDER_VID = "https://www.w3schools.com/html/mov_bbb.mp4";

        const GRID_COLORS = [
            '#EF4444', 
            '#F97316', 
            '#F59E0B', 
            '#10B981', 
            '#3B82F6', 
            '#6366F1', 
            '#8B5CF6', 
            '#EC4899', 
            '#FBBF24', 
            '#A78BFA', 
            '#4ADE80', 
            '#FB7185', 
            '#D946EF', 
            '#06B6D4', 
        ];

        function getColumnIndex(index) {
            return index % NUM_COLS;
        }

        function getColorForColumn(colIndex) {
            return GRID_COLORS[colIndex % GRID_COLORS.length];
        }


        const DEFAULT_CONTENT = {
            title: "3D&Motion Creative&Production",
            subtitle: "Powerd by REDesign",
            webTitle: "çµæ„ŸçŸ©é˜µ | è®¾è®¡ä½œå“é›†",
            titleStyle: {
                size: 'text-8xl', 
                weight: 'font-extrabold',
                color: '#FFFFFF', 
                spacing: 'tracking-normal'
            },
            subtitleStyle: {
                size: 'text-2xl', 
                weight: 'font-normal',
                color: '#9CA3AF', 
                spacing: 'tracking-normal'
            }
        };

        let items = []; 
        let itemData = {}; 
        let mousePos = { x: 0, y: 0 }; 
        let isMouseActive = false; 
        let animationFrameId = null; 
        let isPanning = false;
        let panOffset = { x: 0, y: 0 };
        let lastPanPos = { x: 0, y: 0 };
        let isAnimatingPan = false;
        let targetPanOffset = { x: 0, y: 0 };
        let itemToOpen = null;
        let parallaxOffset = { x: 0, y: 0 };
        const PARALLAX_INTENSITY = 0.4; 
        let isAdminMode = false;
        let editingItemId = null; 

        // ä½¿ç”¨ç¡¬ç¼–ç çš„ appId æ¥æ„å»º Firestore è·¯å¾„
        const getTopBannerDocPath = (appIdentifier) => `/artifacts/${appIdentifier}/public/data/homepage_content/top_banner`;
        const getGridCollectionPath = (appIdentifier) => `/artifacts/${appIdentifier}/public/data/grid_items`;


        // --- æ ·å¼è¾…åŠ©å‡½æ•° (ä¿æŒä¸å˜) ---

        function applyTextStyles(element, styleData, isTitle) {
            if (!element) return; // å¢åŠ ç©ºå€¼æ£€æŸ¥

            const prefixesToClear = [
                'text-', 'font-', 'tracking-' 
            ];
            
            element.className = element.className.split(' ').filter(c => 
                !prefixesToClear.some(prefix => c.startsWith(prefix))
            ).join(' ');

            if (styleData.size) element.classList.add(styleData.size);
            if (styleData.weight) element.classList.add(styleData.weight);
            if (styleData.spacing) element.classList.add(styleData.spacing);
            
            element.style.color = styleData.color || (isTitle ? '#FFFFFF' : '#9CA3AF');

            if (isTitle) {
                element.classList.add('mb-4', 'transition-colors', 'duration-500', 'hover:text-yellow-400', 'cursor-text');
                element.classList.add('md:text-8xl'); 
            } else {
                element.classList.add('transition-colors', 'duration-500', 'hover:text-gray-200', 'cursor-text');
                element.classList.add('md:text-2xl'); 
            }
        }

        // --- Admin/Auth é€»è¾‘ (å·²ä¿®æ”¹) ---

        window.setAdminMode = (mode) => {
            isAdminMode = mode;
            if (!adminToggleBtn || !topContentArea) return; // å¢åŠ ç©ºå€¼æ£€æŸ¥
            
            if (mode) {
                adminToggleBtn.textContent = 'Admin Mode (ON)';
                adminToggleBtn.classList.add('bg-red-600', 'hover:bg-red-700');
                adminToggleBtn.classList.remove('bg-gray-700', 'hover:bg-gray-600');
                isAnimatingPan = false;
                itemToOpen = null;
                topContentArea.classList.add('border-b-4', 'border-red-600');
                window.closeAuthModal(); 
                console.log("Admin Mode activated.");
            } else {
                adminToggleBtn.textContent = 'Admin Mode (OFF)';
                adminToggleBtn.classList.remove('bg-red-600', 'hover:bg-red-700');
                adminToggleBtn.classList.add('bg-gray-700', 'hover:bg-gray-600');
                topContentArea.classList.remove('border-b-4', 'border-red-600');
                console.log("Admin Mode deactivated.");
            }
        };

        window.handleAdminToggle = () => {
            if (!adminToggleBtn) return; // å¢åŠ ç©ºå€¼æ£€æŸ¥
            if (isAdminMode) {
                window.setAdminMode(false);
            } else {
                window.openAuthModal();
            }
        };

        window.openAuthModal = () => {
            if (!authModal || !authErrorMessageEl || !authPasswordEl) return; // å¢åŠ ç©ºå€¼æ£€æŸ¥

            authErrorMessageEl.classList.add('hidden'); 
            authPasswordEl.value = ''; 
            authModal.classList.remove('hidden');
        };

        window.closeAuthModal = () => {
            if (!authModal) return; // å¢åŠ ç©ºå€¼æ£€æŸ¥
            authModal.classList.add('hidden');
        };

        window.handleAdminLogin = () => {
            if (!authUsernameEl || !authPasswordEl || !authErrorMessageEl) return; // å¢åŠ ç©ºå€¼æ£€æŸ¥

            const username = authUsernameEl.value.trim();
            const password = authPasswordEl.value.trim();
            
            // ç®€å•ç¡¬ç¼–ç çš„ç®¡ç†å‘˜å‡­è¯
            const correctUsername = 'admin';
            const correctPassword = '1234'; 

            if (username === correctUsername && password === correctPassword) {
                window.setAdminMode(true);
            } else {
                authErrorMessageEl.classList.remove('hidden');
                authPasswordEl.value = ''; 
            }
        };
        
        /**
         * åˆ‡æ¢ç¼–è¾‘æ¨¡å¼ (é¡¶éƒ¨æ–‡æœ¬) - ä»…å½“ Admin Mode å¯ç”¨æ—¶æ‰èƒ½ç¼–è¾‘
         */
        window.toggleEditMode = (enable) => {
            if (!isAdminMode || !editContainer || !contentDisplay || !mainTitleEl || !subTextEl || !editWebTitleEl) {
                return; // å¢åŠ å¤§é‡ç©ºå€¼æ£€æŸ¥
            }
            
            if (enable) {
                const titleStyle = mainTitleEl.dataset.style ? JSON.parse(mainTitleEl.dataset.style) : DEFAULT_CONTENT.titleStyle;
                const subtitleStyle = subTextEl.dataset.style ? JSON.parse(subTextEl.dataset.style) : DEFAULT_CONTENT.subtitleStyle;

                // å¡«å……ç½‘ç«™åç§°
                document.getElementById('web-title').textContent = DEFAULT_CONTENT.webTitle; 
                editWebTitleEl.value = document.getElementById('web-title').textContent;

                // å¡«å……æ–‡æœ¬å†…å®¹
                editTitleEl.value = mainTitleEl.textContent;
                editSubtitleEl.value = subTextEl.textContent;

                // å¡«å……ä¸»æ ‡é¢˜æ ·å¼
                editTitleSizeEl.value = titleStyle.size;
                editTitleWeightEl.value = titleStyle.weight;
                editTitleColorPickerEl.value = titleStyle.color;
                editTitleSpacingEl.value = titleStyle.spacing;

                // å¡«å……å‰¯æ ‡é¢˜æ ·å¼
                editSubtitleSizeEl.value = subtitleStyle.size;
                editSubtitleWeightEl.value = subtitleStyle.weight;
                editSubtitleColorPickerEl.value = subtitleStyle.color;
                editSubtitleSpacingEl.value = subtitleStyle.spacing;

                contentDisplay.classList.add('hidden');
                editContainer.classList.remove('hidden');
            } else {
                contentDisplay.classList.remove('hidden');
                editContainer.classList.add('hidden');
            }
        };

        /**
         * ä¿å­˜å†…å®¹åˆ° Firestore (é¡¶éƒ¨æ–‡æœ¬)
         */
        window.saveContent = async () => {
            if (!editWebTitleEl || !editTitleEl || !editSubtitleEl || !editTitleSizeEl) {
                return console.error("Missing edit elements. Cannot save."); // å¢åŠ ç©ºå€¼æ£€æŸ¥
            }

            const newWebTitle = editWebTitleEl.value.trim(); 
            const newTitle = editTitleEl.value.trim();
            const newSubtitle = editSubtitleEl.value.trim();

            // æ£€æŸ¥ï¼šå¦‚æœ Firebase æœªåˆå§‹åŒ–æˆ–å¤„äºæœ¬åœ°æ¨¡å¼ï¼Œåˆ™ä¸èƒ½ä¿å­˜
            if (isLocalMode || !db || !appId) return console.error("Firestore is not initialized. Cannot save in local mode. Please check Firebase config.");
            if (!isAdminMode) return console.error("Permission denied. Admin mode required.");

            const docRef = doc(db, getTopBannerDocPath(appId));
            
            const newTitleStyle = {
                size: editTitleSizeEl.value,
                weight: editTitleWeightEl.value,
                color: editTitleColorPickerEl.value,
                spacing: editTitleSpacingEl.value,
            };

            const newSubtitleStyle = {
                size: editSubtitleSizeEl.value,
                weight: editSubtitleWeightEl.value,
                color: editSubtitleColorPickerEl.value,
                spacing: editSubtitleSpacingEl.value,
            };

            try {
                await setDoc(docRef, {
                    webTitle: newWebTitle || DEFAULT_CONTENT.webTitle, 
                    title: newTitle || DEFAULT_CONTENT.title,
                    subtitle: newSubtitle || DEFAULT_CONTENT.subtitle,
                    titleStyle: newTitleStyle,
                    subtitleStyle: newSubtitleStyle,
                    timestamp: new Date()
                });
                console.log("Content saved successfully.");
                window.toggleEditMode(false);
            } catch (e) {
                console.error("Error saving document: ", e);
            }
        };

        /**
         * **æœ¬åœ°å›é€€é€»è¾‘**ï¼šå¦‚æœæ— æ³•è¿æ¥ Firebaseï¼Œåˆ™ä½¿ç”¨é»˜è®¤æ•°æ®å¹¶ç«‹å³æ¸²æŸ“ã€‚
         */
        window.runLocalFallback = () => {
            if (!mainTitleEl || !subTextEl || !gridContainer) {
                 console.error("Critical DOM elements (mainTitleEl/subTextEl/gridContainer) not found for fallback.");
                 return;
            }
            isLocalMode = true;
            console.warn("Firebase connection failed. Running in Local Mode (Read-Only) with default data.");
            
            // 1. ç«‹å³åº”ç”¨é»˜è®¤å†…å®¹
            document.title = DEFAULT_CONTENT.webTitle; 
            mainTitleEl.textContent = DEFAULT_CONTENT.title;
            subTextEl.textContent = DEFAULT_CONTENT.subtitle;
            applyTextStyles(mainTitleEl, DEFAULT_CONTENT.titleStyle, true);
            applyTextStyles(subTextEl, DEFAULT_CONTENT.subtitleStyle, false);
            
            // 2. åˆå§‹åŒ–ç½‘æ ¼æ•°æ®å¹¶æ¸²æŸ“
            initializeDefaultGridData(); 
            createGrid(); 
        };


        /**
         * ç›‘å¬ Firestore ä¸Šçš„å†…å®¹å˜åŒ–
         * @param {object} firestore ä¼ å…¥çš„ db å®ä¾‹
         * @param {string} appIdentifier ä¼ å…¥çš„ appId
         */
        window.setupContentListener = (firestore, appIdentifier) => {
            if (!mainTitleEl || !subTextEl) return; // å¢åŠ ç©ºå€¼æ£€æŸ¥
            
            const docRef = doc(firestore, getTopBannerDocPath(appIdentifier)); 

            onSnapshot(docRef, (docSnap) => {
                let data = {};
                if (docSnap.exists()) {
                    data = docSnap.data();
                }

                const currentWebTitle = data.webTitle || DEFAULT_CONTENT.webTitle; 
                const currentTitle = data.title || DEFAULT_CONTENT.title;
                const currentSubtitle = data.subtitle || DEFAULT_CONTENT.subtitle;
                const currentTitleStyle = data.titleStyle || DEFAULT_CONTENT.titleStyle;
                const currentSubtitleStyle = data.subtitleStyle || DEFAULT_CONTENT.subtitleStyle;

                document.title = currentWebTitle; 
                mainTitleEl.textContent = currentTitle;
                subTextEl.textContent = currentSubtitle;

                applyTextStyles(mainTitleEl, currentTitleStyle, true);
                applyTextStyles(subTextEl, currentSubtitleStyle, false);

                mainTitleEl.dataset.style = JSON.stringify(currentTitleStyle);
                subTextEl.dataset.style = JSON.stringify(currentSubtitleStyle);

            }, (error) => {
                console.error("Error listening to content:", error);
            });
        };

        /**
         * ç›‘å¬ Firestore ä¸Šçš„ç½‘æ ¼é¡¹ç›®å˜åŒ–
         * @param {object} firestore ä¼ å…¥çš„ db å®ä¾‹
         * @param {string} appIdentifier ä¼ å…¥çš„ appId
         */
        window.setupGridListener = (firestore, appIdentifier) => {
            if (!gridContainer) return; // å¢åŠ ç©ºå€¼æ£€æŸ¥
            
            const colRef = collection(firestore, getGridCollectionPath(appIdentifier)); 

            onSnapshot(colRef, (snapshot) => {
                let initialLoad = Object.keys(itemData).length === 0;
                
                const newItemsFromFirestore = {};
                snapshot.docChanges().forEach(change => {
                    const data = change.doc.data();
                    const itemId = change.doc.id;
                    const i = parseInt(itemId.split('_')[1]);
                    const colIndex = getColumnIndex(i);
                    const defaultColor = getColorForColumn(colIndex);

                    newItemsFromFirestore[itemId] = {
                        img: data.img || null, 
                        vid: data.vid || PLACEHOLDER_VID,
                        bgColor: data.bgColor || defaultColor 
                    };
                });
                itemData = newItemsFromFirestore; // Update global itemData

                if (initialLoad) {
                    let needsDefaultInit = false;
                    for (let i = 0; i < TOTAL_ITEMS; i++) {
                        const itemId = `item_${i}`;
                        if (!itemData[itemId]) {
                            needsDefaultInit = true;
                            break;
                        }
                    }

                    if(needsDefaultInit) {
                        initializeDefaultGridData();
                    }
                    createGrid();
                } else {
                    updateGridDOM();
                }
            }, async (error) => {
                console.error("Error listening to grid items:", error);
                if (Object.keys(itemData).length === 0) {
                    await initializeDefaultGridData();
                    createGrid();
                }
            });
        };
        
        /**
         * åˆå§‹åŒ–é»˜è®¤ç½‘æ ¼æ•°æ® (æœ¬åœ°æ¨¡å¼ä¸‹ä¸å†™å…¥ DB)
         */
        async function initializeDefaultGridData() {
            if (!gridContainer) return; // å¢åŠ ç©ºå€¼æ£€æŸ¥

            // å¦‚æœæ˜¯æœ¬åœ°æ¨¡å¼ï¼Œåªå¡«å…… itemData æ•°ç»„ï¼Œä¸è¿›è¡Œ DB æ“ä½œ
            if (isLocalMode) {
                for (let i = 0; i < TOTAL_ITEMS; i++) {
                    const itemId = `item_${i}`;
                    const colIndex = getColumnIndex(i);
                    itemData[itemId] = {
                        img: null,
                        vid: PLACEHOLDER_VID,
                        bgColor: getColorForColumn(colIndex)
                    };
                }
                return; 
            }

            // è¿œç¨‹æ¨¡å¼ (Firestore å­˜åœ¨)
            if (!db || !appId) return console.error("Firestore DB/App ID not ready for default initialization.");

            const colRef = collection(db, getGridCollectionPath(appId));
            const snapshot = await getDocs(colRef);

            if (snapshot.empty) {
                console.log("No existing grid data. Initializing default items.");
                for (let i = 0; i < TOTAL_ITEMS; i++) {
                    const itemId = `item_${i}`;
                    const colIndex = getColumnIndex(i);
                    const defaultColor = getColorForColumn(colIndex);

                    itemData[itemId] = {
                        img: null, 
                        vid: PLACEHOLDER_VID,
                        bgColor: defaultColor
                    };
                    // ä»…å†™å…¥ä¸€å°éƒ¨åˆ†æ•°æ®åˆ° Firestoreï¼Œå…¶ä½™ç”±å®¢æˆ·ç«¯å¤„ç†
                    if (i < 5) { 
                        await setDoc(doc(db, getGridCollectionPath(appId), itemId), itemData[itemId]);
                    }
                }
            } else {
                 snapshot.docs.forEach(doc => {
                    const data = doc.data();
                    const i = parseInt(doc.id.split('_')[1]);
                    const colIndex = getColumnIndex(i);
                    const defaultColor = getColorForColumn(colIndex);

                    itemData[doc.id] = {
                        img: data.img || null,
                        vid: data.vid || PLACEHOLDER_VID,
                        bgColor: data.bgColor || defaultColor
                    };
                });
            }
        }
        
        function createGrid() {
            if (items.length > 0 || !gridContainer) return; // å¢åŠ ç©ºå€¼æ£€æŸ¥
            
            gridContainer.innerHTML = ''; 
            gridContainer.style.gridTemplateColumns = `repeat(${NUM_COLS}, 1fr)`;

            for (let i = 0; i < TOTAL_ITEMS; i++) {
                const itemId = `item_${i}`;
                const data = itemData[itemId]; 

                const item = document.createElement('div');
                item.className = 'grid-item aspect-square bg-cover bg-center cursor-pointer';
                
                if (data && data.img && data.img.trim()) {
                    item.style.backgroundImage = `url(${data.img})`;
                    item.style.backgroundColor = 'transparent';
                } else if (data && data.bgColor) {
                    item.style.backgroundImage = 'none';
                    item.style.backgroundColor = data.bgColor;
                } else {
                    const colIndex = getColumnIndex(i);
                    item.style.backgroundImage = 'none';
                    item.style.backgroundColor = getColorForColumn(colIndex);
                }

                item.style.transform = `scale(${MIN_SCALE})`; 
                item.style.opacity = '0.7'; 

                item.dataset.videoId = itemId;
                
                gridContainer.appendChild(item);
                
                item.twinklePhase = Math.random() * 2 * Math.PI;
                item.twinkleSpeed = 0.5 + Math.random() * 0.5;

                items.push({ 
                    el: item, 
                    center: { x: 0, y: 0 },
                    twinklePhase: item.twinklePhase,
                    twinkleSpeed: item.twinkleSpeed
                });
            }
            
            cacheItemPositions();
        }

        function updateGridDOM() {
            if (items.length === 0 || !gridContainer) return; // å¢åŠ ç©ºå€¼æ£€æŸ¥

            for(let i = 0; i < items.length; i++) {
                const itemId = `item_${i}`;
                const data = itemData[itemId];
                
                if (data) { 
                    if (data.img && data.img.trim()) {
                        items[i].el.style.backgroundImage = `url(${data.img})`;
                        items[i].el.style.backgroundColor = 'transparent';
                    } else {
                        items[i].el.style.backgroundImage = 'none';
                        items[i].el.style.backgroundColor = data.bgColor;
                    }
                } else {
                    const itemIndex = parseInt(itemId.split('_')[1]);
                    const colIndex = getColumnIndex(itemIndex);
                    items[i].el.style.backgroundImage = 'none';
                    items[i].el.style.backgroundColor = getColorForColumn(colIndex);
                }
            }
        }

        window.openItemEditPanel = (itemElement) => {
            if (!itemEditModal || !itemEditIdEl || !editImageUrlEl || !editVideoUrlEl) return; // å¢åŠ ç©ºå€¼æ£€æŸ¥
            if (!isAdminMode) return console.error("Permission denied. Admin mode required.");
            if (isLocalMode) return console.error("Cannot edit in local mode. Requires Firebase connection.");

            editingItemId = itemElement.dataset.videoId;
            let data = itemData[editingItemId]; 
            
            if (!data) {
                const parts = editingItemId.split('_');
                if (parts.length < 2) return console.error("Invalid item ID format:", editingItemId);
                
                const itemIndex = parseInt(parts[1]);
                const colIndex = getColumnIndex(itemIndex);
                
                data = {
                    img: null, 
                    vid: PLACEHOLDER_VID,
                    bgColor: getColorForColumn(colIndex)
                };
            }

            itemEditIdEl.textContent = `(ID: ${editingItemId})`;
            editImageUrlEl.value = data.img || ''; 
            editVideoUrlEl.value = data.vid;
            
            itemEditModal.classList.remove('hidden');
            isAnimatingPan = false;
            itemToOpen = null;
        };
        
        window.closeItemEditPanel = () => {
            if (!itemEditModal) return; // å¢åŠ ç©ºå€¼æ£€æŸ¥
            itemEditModal.classList.add('hidden');
            editingItemId = null;
            isMouseActive = true;
            startAnimationLoop();
        };

        window.saveItemChanges = async () => {
            if (!editImageUrlEl || !editVideoUrlEl) return; // å¢åŠ ç©ºå€¼æ£€æŸ¥

            const newImg = editImageUrlEl.value.trim();
            const newVid = editVideoUrlEl.value.trim();

            if (isLocalMode || !db || !appId || !editingItemId) return console.error("Invalid state for saving. Cannot save in local mode.");
            if (!isAdminMode) return console.error("Permission denied. Admin mode required.");

            const itemIndex = parseInt(editingItemId.split('_')[1]);
            const colIndex = getColumnIndex(itemIndex);
            const defaultColor = getColorForColumn(colIndex);

            const dataToSave = { 
                vid: newVid,
                bgColor: itemData[editingItemId]?.bgColor || defaultColor, 
            };
            
            if (newImg) {
                dataToSave.img = newImg; 
            } else {
                dataToSave.img = null; 
            }

            const docRef = doc(db, getGridCollectionPath(appId), editingItemId);

            try {
                await setDoc(docRef, dataToSave, { merge: true }); 
                console.log(`Item ${editingItemId} saved successfully.`);
                window.closeItemEditPanel();
            } catch (e) {
                console.error("Error saving grid item: ", e);
            }
        };

        /**
         * 1. è·å–æ‰€æœ‰ DOM å…ƒç´ çš„å¼•ç”¨
         * 2. ç»‘å®šæ‰€æœ‰äº‹ä»¶ç›‘å¬å™¨
         */
        function setupDOMAndListeners() {
            // --- 1. DOM å…ƒç´ è·å– (ç°åœ¨æ˜¯å®‰å…¨çš„ï¼Œåœ¨ window.onload ä¹‹åæ‰§è¡Œ) ---
            gridContainer = document.getElementById('grid-container');
            modal = document.getElementById('video-modal');
            videoPlayer = document.getElementById('video-player');
            closeModal = document.getElementById('close-modal');
            mainTitleEl = document.getElementById('main-title');
            subTextEl = document.getElementById('sub-text');
            editContainer = document.getElementById('edit-mode-container');
            contentDisplay = document.getElementById('content-display');
            editTitleEl = document.getElementById('edit-title');
            editSubtitleEl = document.getElementById('edit-subtitle');
            topContentArea = document.getElementById('top-content-area');

            // Admin Text Edit Elements
            editWebTitleEl = document.getElementById('edit-web-title'); 
            editTitleSizeEl = document.getElementById('edit-title-size');
            editTitleWeightEl = document.getElementById('edit-title-weight');
            editTitleColorPickerEl = document.getElementById('edit-title-color-picker');
            editTitleSpacingEl = document.getElementById('edit-title-spacing');
            editSubtitleSizeEl = document.getElementById('edit-subtitle-size');
            editSubtitleWeightEl = document.getElementById('edit-subtitle-weight');
            editSubtitleColorPickerEl = document.getElementById('edit-subtitle-color-picker');
            editSubtitleSpacingEl = document.getElementById('edit-subtitle-spacing');


            // Admin UI elements
            adminToggleBtn = document.getElementById('admin-toggle-btn');
            itemEditModal = document.getElementById('item-edit-modal');
            itemEditIdEl = document.getElementById('item-edit-id');
            editImageUrlEl = document.getElementById('edit-image-url');
            editVideoUrlEl = document.getElementById('edit-video-url');
            // Auth UI elements
            authModal = document.getElementById('auth-modal');
            authUsernameEl = document.getElementById('auth-username');
            authPasswordEl = document.getElementById('auth-password');
            authErrorMessageEl = document.getElementById('auth-error-message');
            
            // --- CRITICAL SAFETY CHECK ---
            // ç¡®ä¿æœ€ä¸»è¦çš„å…ƒç´ å·²è¢«è·å–ï¼Œå¦åˆ™åœæ­¢è®¾ç½®ç›‘å¬å™¨
            if (!gridContainer || !closeModal || !modal) {
                console.error("Critical DOM elements not found. Stopping setupDOMAndListeners.");
                return;
            }

            // --- 2. ç»‘å®šäº‹ä»¶ç›‘å¬å™¨ (ç°åœ¨æ˜¯å®‰å…¨çš„) ---

            window.addEventListener('mousemove', (e) => {
                mousePos.x = e.clientX;
                mousePos.y = e.clientY;

                if (isPanning) {
                    e.preventDefault();
                    const dx = e.clientX - lastPanPos.x;
                    const dy = e.clientY - lastPanPos.y;
                    panOffset.x += dx;
                    panOffset.y += dy;
                    applyGridTransform();
                    lastPanPos = { x: e.clientX, y: e.clientY };
                } 
                else if (!isMouseActive) {
                    isMouseActive = true;
                    startAnimationLoop();
                }
            });

            window.addEventListener('mouseenter', () => {
                if (!isMouseActive) {
                    isMouseActive = true;
                    startAnimationLoop();
                }
            });

            window.addEventListener('mouseleave', () => {
                isMouseActive = false;
                resetGrid(); 
            });

            gridContainer.addEventListener('click', (e) => {
                if (isPanning || isAnimatingPan) return;

                const itemElement = e.target.closest('.grid-item');
                if (itemElement) {
                    const itemId = itemElement.dataset.videoId;
                    const clickedItem = items.find(i => i.el === itemElement);
                    if (!clickedItem) return;
                    
                    // å¦‚æœæ˜¯ Admin æ¨¡å¼ï¼Œæ‰“å¼€ç¼–è¾‘é¢æ¿
                    if (isAdminMode) {
                        window.openItemEditPanel(itemElement);
                        return; 
                    }

                    // æ­£å¸¸æ’­æ”¾æ¨¡å¼
                    isMouseActive = false; 
                    
                    const targetX = window.innerWidth / 2;
                    const targetY = window.innerHeight / 2;
                    
                    targetPanOffset = {
                        x: targetX - clickedItem.center.x,
                        y: targetY - clickedItem.center.y
                    };

                    isAnimatingPan = true;
                    itemToOpen = clickedItem;

                    startAnimationLoop();
                }
            });

            closeModal.addEventListener('click', closeVideoModalFunc);
            modal.addEventListener('click', (e) => {
                if (e.target === modal) {
                    closeVideoModalFunc();
                }
            });

            let resizeTimer;
            window.addEventListener('resize', () => {
                clearTimeout(resizeTimer);
                resizeTimer = setTimeout(() => {
                    cacheItemPositions();
                }, 100);
            });

            gridContainer.addEventListener('mousedown', (e) => {
                if (e.button === 1 && !isAdminMode) { 
                    e.preventDefault();
                    isPanning = true;
                    isMouseActive = false; 
                    isAnimatingPan = false; 
                    itemToOpen = null;      
                    
                    resetGrid(); 
                    lastPanPos = { x: e.clientX, y: e.clientY };
                    gridContainer.style.cursor = 'grabbing';
                    
                    startAnimationLoop();
                }
            });

            window.addEventListener('mouseup', (e) => {
                if (isPanning && e.button === 1) {
                    isPanning = false;
                    gridContainer.style.cursor = 'default';
                    
                    isMouseActive = true;
                    startAnimationLoop();
                }
            });

            window.addEventListener('contextmenu', (e) => {
                if (isPanning || e.button === 1) {
                    e.preventDefault();
                }
            });
        }


        /**
         * ä¿®å¤æƒé™é”™è¯¯ï¼šç¡®ä¿èº«ä»½éªŒè¯æˆåŠŸåæ‰è®¾ç½® Firestore ç›‘å¬å™¨ã€‚
         */
        window.setupApp = async () => {
            
            setupDOMAndListeners(); // <-- å¿…é¡»åœ¨æ“ä½œ DOM ä¹‹å‰è¿è¡Œ

            // æ£€æŸ¥ Firebase é…ç½®æ˜¯å¦æœ‰æ•ˆ (ç°åœ¨æ˜¯æ£€æŸ¥ç¡¬ç¼–ç çš„é…ç½®)
            const hasFirebaseConfig = Object.keys(firebaseConfig).length > 0 && firebaseConfig.apiKey !== 'YOUR_REAL_API_KEY_HERE'; 

            if (!hasFirebaseConfig) {
                window.runLocalFallback(); // å¦‚æœé…ç½®ç¼ºå¤±æˆ–ä½¿ç”¨å ä½ç¬¦ï¼Œè¿è¡Œæœ¬åœ°å›é€€
                return;
            }

            try {
                const app = initializeApp(firebaseConfig);
                db = getFirestore(app); // èµ‹å€¼ç»™å…¨å±€å˜é‡ db
                auth = getAuth(app); // èµ‹å€¼ç»™å…¨å±€å˜é‡ auth
                
                setLogLevel('error'); 

                // --- 1. å°è¯•æ‰§è¡Œèº«ä»½éªŒè¯ ---
                if (initialAuthToken) {
                    await signInWithCustomToken(auth, initialAuthToken).catch(e => { // ä½¿ç”¨ auth
                        console.error("Custom token sign-in failed (ignored for GH Pages):", e);
                        // å³ä½¿ custom token å¤±è´¥ï¼Œä¹Ÿå°è¯•åŒ¿åç™»å½•
                        signInAnonymously(auth);
                    });
                } else {
                    await signInAnonymously(auth).catch(e => { // ä½¿ç”¨ auth
                        console.error("Anonymous sign-in failed:", e);
                    });
                }
                console.log("Firebase authentication attempt completed.");


                // --- 2. ç›‘å¬å™¨ç¡®ä¿ Firestore å®¢æˆ·ç«¯å‡†å¤‡å°±ç»ª ---
                const unsubscribe = onAuthStateChanged(auth, (user) => { // ä½¿ç”¨ auth
                    if (user) {
                        console.log("User state confirmed. Setting up Firestore listeners.");
                        window.setupContentListener(db, appId);
                        window.setupGridListener(db, appId);
                        unsubscribe(); 
                    } else {
                        console.warn("User is not logged in. Waiting for sign-in state.");
                    }
                }, (error) => {
                     console.error("onAuthStateChanged error:", error);
                     window.runLocalFallback(); // å¦‚æœè®¤è¯ç›‘å¬å™¨å¤±è´¥ï¼Œä¹Ÿå›é€€
                });
                
            } catch (error) {
                // æ•è· Firebase åˆå§‹åŒ–é”™è¯¯
                console.error("Firebase Initialization/Sign-In Error, falling back:", error);
                window.runLocalFallback(); // æ•è·åˆå§‹åŒ–é”™è¯¯ï¼Œè¿è¡Œæœ¬åœ°å›é€€
            }
        };

        // Call initialization on load
        window.addEventListener('load', window.setupApp);

        // --- åŸæœ‰åŠ¨ç”»/äº¤äº’å‡½æ•° (ä¿æŒ) ---

        function cacheItemPositions() {
            if (!gridContainer) return; // å¢åŠ ç©ºå€¼æ£€æŸ¥
            
            const oldTransform = gridContainer.style.transform;
            gridContainer.style.transform = ''; 

            for (const item of items) {
                const rect = item.el.getBoundingClientRect();
                item.center = {
                    x: rect.left + rect.width / 2,
                    y: rect.top + rect.height / 2
                };
            }

            gridContainer.style.transform = oldTransform;
        }

        function applyGridTransform() {
            if (!gridContainer) return; // å¢åŠ ç©ºå€¼æ£€æŸ¥ï¼Œä¿®å¤ç¬¬äºŒä¸ªé”™è¯¯

            const finalX = panOffset.x + parallaxOffset.x;
            const finalY = panOffset.y + parallaxOffset.y;
            gridContainer.style.transform = `translate(${finalX}px, ${finalY}px)`;
        }

        function updateFisheyeEffect() {
            if (!gridContainer) { // å†æ¬¡æ£€æŸ¥å…³é”®å…ƒç´ ï¼Œé˜²æ­¢åŠ¨ç”»å¾ªç¯ä¸­å‡ºç°é—®é¢˜
                 animationFrameId = null;
                 return;
            }

            // --- 1. å¤„ç†ç‚¹å‡»å¹³ç§»åŠ¨ç”» ---
            if (isAnimatingPan) {
                const easing = 0.08; 
                panOffset.x += (targetPanOffset.x - panOffset.x) * easing;
                panOffset.y += (targetPanOffset.y - panOffset.y) * easing;

                parallaxOffset.x = 0;
                parallaxOffset.y = 0;

                const dx = targetPanOffset.x - panOffset.x;
                const dy = targetPanOffset.y - panOffset.y;

                if (Math.abs(dx) < 0.5 && Math.abs(dy) < 0.5) {
                    isAnimatingPan = false;
                    panOffset.x = targetPanOffset.x; 
                    panOffset.y = targetPanOffset.y;
                    
                    if (itemToOpen) {
                        const videoSrc = itemData[itemToOpen.el.dataset.videoId]?.vid || PLACEHOLDER_VID;
                        openVideoModal(videoSrc);
                        itemToOpen = null;
                    }
                }
            }
            // --- 2. å¤„ç†é¼ æ ‡è§†å·® (ä»…å½“é¼ æ ‡æ¿€æ´»ä¸”æœªè¿›è¡Œå…¶ä»–å¹³ç§»æ—¶) ---
            else if (isMouseActive && !isPanning) {
                const centerX = window.innerWidth / 2;
                const centerY = window.innerHeight / 2;
                const dx_parallax = mousePos.x - centerX;
                const dy_parallax = mousePos.y - centerY;
                
                parallaxOffset.x = -dx_parallax * PARALLAX_INTENSITY;
                parallaxOffset.y = -dy_parallax * PARALLAX_INTENSITY;
            }
            // --- 3. é¼ æ ‡ç§»å‡ºæˆ–æ‰‹åŠ¨å¹³ç§»æ—¶ ---
            else {
                parallaxOffset.x = 0;
                parallaxOffset.y = 0;
            }

            // --- 4. åº”ç”¨å˜æ¢ ---
            applyGridTransform(); 

            if (isPanning || isAdminMode) {
                animationFrameId = requestAnimationFrame(updateFisheyeEffect);
                return;
            }

            // --- 5. é±¼çœ¼æ•ˆæœè®¡ç®— (è·Ÿéšé¼ æ ‡) ---
            const fisheyeCenterX = mousePos.x;
            const fisheyeCenterY = mousePos.y;

            for (const item of items) {
                const adjustedItemCenterX = item.center.x + panOffset.x + parallaxOffset.x; 
                const adjustedItemCenterY = item.center.y + panOffset.y + parallaxOffset.y; 

                const dx = fisheyeCenterX - adjustedItemCenterX;
                const dy = fisheyeCenterY - adjustedItemCenterY;
                const dist = Math.sqrt(dx * dx + dy * dy);

                let scale;
                let opacity;
                let zIndex = 1;
                let brightness = 1.0; 

                if (dist >= EFFECT_RADIUS) {
                    
                    opacity = 0.7;
                    
                    // --- 6. å¼ºåŒ–é—ªçƒæ•ˆæœ (Twinkling: äº®åº¦ + å¤§å°) ---
                    item.twinklePhase += (0.02 + Math.random() * 0.01) * item.twinkleSpeed;
                    const sineVal = (Math.sin(item.twinklePhase) + 1) / 2; // Range [0, 1]
                    
                    const minBrightness = 0.2; 
                    const maxBrightness = 1.4; 
                    const brightnessRange = maxBrightness - minBrightness; 
                    brightness = minBrightness + (brightnessRange * sineVal);
                    
                    const minTwinkleScale = MIN_SCALE * 0.70; 
                    const maxTwinkleScale = MIN_SCALE * 1.30; 
                    const scaleRange = maxTwinkleScale - minTwinkleScale;
                    
                    scale = minTwinkleScale + (scaleRange * sineVal); 
                    
                } else {
                    // é±¼çœ¼æ•ˆæœåŒºåŸŸ
                    const proximity = 1 - (dist / EFFECT_RADIUS);
                    
                    const easedProximity = 1 - Math.pow(1 - proximity, 2); 
                    
                    scale = MIN_SCALE + (MAX_SCALE - MIN_SCALE) * easedProximity;
                    opacity = 0.7 + (1.0 - 0.7) * easedProximity;
                    
                    zIndex = 2 + Math.floor(proximity * 8); 
                    brightness = 1.0; 
                }

                item.el.style.transform = `translateZ(0) scale(${scale})`;
                item.el.style.opacity = opacity;
                item.el.style.zIndex = zIndex;
                item.el.style.filter = `brightness(${brightness})`;
            }
            
            if (isAnimatingPan || (isMouseActive && !isPanning)) {
                animationFrameId = requestAnimationFrame(updateFisheyeEffect);
            } else {
                animationFrameId = null; 
            }
        }

        function startAnimationLoop() {
            if (!gridContainer) return; // å¢åŠ ç©ºå€¼æ£€æŸ¥
            if (!animationFrameId) {
                animationFrameId = requestAnimationFrame(updateFisheyeEffect);
            }
        }

        function resetGrid() {
            if (items.length === 0 || !gridContainer) return; // å¢åŠ ç©ºå€¼æ£€æŸ¥

            for (const item of items) {
                item.el.style.transform = `scale(${MIN_SCALE})`;
                item.el.style.opacity = '0.7';
                item.el.style.zIndex = 1;
                item.el.style.filter = 'brightness(1.0)'; 
            }
        }

        function openVideoModal(videoSrc) {
            if (!modal || !videoPlayer) return; // å¢åŠ ç©ºå€¼æ£€æŸ¥

            videoPlayer.src = videoSrc;
            modal.classList.remove('hidden');
            videoPlayer.play().catch(e => {
                if (e.name !== 'AbortError') {
                    console.error("è§†é¢‘æ’­æ”¾å¤±è´¥:", e);
                }
            });
        }

        function closeVideoModalFunc() {
            if (!modal || !videoPlayer) return; // å¢åŠ ç©ºå€¼æ£€æŸ¥

            modal.classList.add('hidden');
            videoPlayer.pause();
            videoPlayer.src = ''; 
            isMouseActive = true; 
            startAnimationLoop();
        }

    </script>
    <div id="app-container" class="relative min-h-screen w-full bg-black overflow-hidden">

        <!-- é¡¶éƒ¨å†…å®¹åŒºåŸŸ/ç¼–è¾‘æ¨¡å¼ -->
        <div id="top-content-area" class="fixed top-0 left-0 right-0 p-8 md:p-12 z-20 text-white pointer-events-none transition-all duration-300">
            <div id="content-display" class="flex flex-col">
                <h1 id="main-title" class="text-white text-4xl font-extrabold cursor-text transition-colors duration-500 hover:text-yellow-400 pointer-events-auto" onclick="toggleEditMode(true)">3D&Motion Creative&Production</h1>
                <p id="sub-text" class="text-gray-400 text-base font-normal cursor-text transition-colors duration-500 hover:text-gray-200 pointer-events-auto" onclick="toggleEditMode(true)">Powerd by REDesign</p>
            </div>

            <!-- ç¼–è¾‘æ¨¡å¼ UI (Admin Only) -->
            <div id="edit-mode-container" class="hidden bg-gray-900/90 backdrop-blur-sm p-6 rounded-xl shadow-2xl pointer-events-auto">
                <h2 class="text-xl font-bold mb-4 text-red-400">é¡¶éƒ¨å†…å®¹ç¼–è¾‘ (Admin)</h2>
                
                <div class="space-y-4">
                    <!-- Web Title -->
                    <div>
                        <label class="block text-sm font-medium text-gray-400">ç½‘ç«™æ ‡é¢˜ (Title)</label>
                        <input id="edit-web-title" type="text" class="mt-1 block w-full rounded-md bg-gray-700 border-gray-600 text-white p-2" value="çµæ„ŸçŸ©é˜µ | è®¾è®¡ä½œå“é›†">
                    </div>
                    
                    <!-- Main Title Edit -->
                    <div class="p-4 bg-gray-800 rounded-lg">
                        <label class="block text-lg font-medium text-white mb-2">ä¸»æ ‡é¢˜</label>
                        <input id="edit-title" type="text" class="mt-1 block w-full rounded-md bg-gray-700 border-gray-600 text-white p-2" value="3D&Motion Creative&Production">
                        <div class="grid grid-cols-2 md:grid-cols-4 gap-3 mt-3 text-sm">
                            <select id="edit-title-size" class="rounded-md bg-gray-700 border-gray-600 text-white p-2">
                                <option value="text-8xl">ç‰¹å¤§å·</option>
                                <option value="text-6xl">å¤§å·</option>
                                <option value="text-4xl">ä¸­å·</option>
                            </select>
                            <select id="edit-title-weight" class="rounded-md bg-gray-700 border-gray-600 text-white p-2">
                                <option value="font-extrabold">æç²—</option>
                                <option value="font-bold">ç²—ä½“</option>
                                <option value="font-semibold">åŠç²—</option>
                            </select>
                            <input id="edit-title-color-picker" type="color" class="h-10 w-full rounded-md bg-gray-700 border-gray-600 p-1 cursor-pointer" value="#FFFFFF">
                            <select id="edit-title-spacing" class="rounded-md bg-gray-700 border-gray-600 text-white p-2">
                                <option value="tracking-normal">é»˜è®¤é—´è·</option>
                                <option value="tracking-wider">æ›´å®½</option>
                                <option value="tracking-tight">æ›´ç´§</option>
                            </select>
                        </div>
                    </div>

                    <!-- Subtitle Edit -->
                    <div class="p-4 bg-gray-800 rounded-lg">
                        <label class="block text-lg font-medium text-white mb-2">å‰¯æ ‡é¢˜</label>
                        <input id="edit-subtitle" type="text" class="mt-1 block w-full rounded-md bg-gray-700 border-gray-600 text-white p-2" value="Powerd by REDesign">
                        <div class="grid grid-cols-2 md:grid-cols-4 gap-3 mt-3 text-sm">
                            <select id="edit-subtitle-size" class="rounded-md bg-gray-700 border-gray-600 text-white p-2">
                                <option value="text-2xl">å¤§å·</option>
                                <option value="text-xl">ä¸­å·</option>
                                <option value="text-base">å°å·</option>
                            </select>
                            <select id="edit-subtitle-weight" class="rounded-md bg-gray-700 border-gray-600 text-white p-2">
                                <option value="font-normal">é»˜è®¤</option>
                                <option value="font-bold">ç²—ä½“</option>
                                <option value="font-extrabold">æç²—</option>
                            </select>
                            <input id="edit-subtitle-color-picker" type="color" class="h-10 w-full rounded-md bg-gray-700 border-gray-600 p-1 cursor-pointer" value="#9CA3AF">
                            <select id="edit-subtitle-spacing" class="rounded-md bg-gray-700 border-gray-600 text-white p-2">
                                <option value="tracking-normal">é»˜è®¤é—´è·</option>
                                <option value="tracking-widest">æœ€å®½</option>
                                <option value="tracking-tight">æ›´ç´§</option>
                            </select>
                        </div>
                    </div>
                </div>

                <div class="flex space-x-4 mt-6">
                    <button class="px-4 py-2 bg-red-600 text-white font-semibold rounded-lg hover:bg-red-700 transition duration-150" onclick="saveContent()">ä¿å­˜æ›´æ”¹</button>
                    <button class="px-4 py-2 bg-gray-500 text-white font-semibold rounded-lg hover:bg-gray-600 transition duration-150" onclick="toggleEditMode(false)">å–æ¶ˆ</button>
                </div>
            </div>
        </div>

        <!-- Admin Toggle Button (å§‹ç»ˆå¯è§ï¼Œä½†åŠŸèƒ½å—é™) -->
        <button id="admin-toggle-btn" onclick="handleAdminToggle()" 
            class="fixed bottom-4 right-4 z-50 px-4 py-2 rounded-full text-white text-sm font-semibold shadow-xl transition-all duration-300 bg-gray-700 hover:bg-gray-600">
            Admin Mode (OFF)
        </button>


        <!-- ç½‘æ ¼å®¹å™¨ (ä½äºä¸­å¿ƒ) -->
        <div id="grid-container" class="absolute inset-0 m-auto grid" 
            style="transform: translate(0, 0); transform-style: preserve-3d;">
            <!-- Grid items will be generated here by JavaScript -->
        </div>

        <!-- è§†é¢‘æ¨¡æ€æ¡† (ç”¨äºæ’­æ”¾é€‰ä¸­çš„é¡¹ç›®) -->
        <div id="video-modal" class="fixed inset-0 bg-black/90 backdrop-blur-sm z-50 flex justify-center items-center hidden transition-opacity duration-300">
            <div class="relative w-full max-w-4xl h-auto aspect-video rounded-xl shadow-2xl overflow-hidden">
                <video id="video-player" class="w-full h-full object-cover" controls autoplay playsinline></video>
                <button id="close-modal" class="absolute top-4 right-4 text-white p-2 rounded-full bg-black/50 hover:bg-black/80 transition" aria-label="Close video">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
                    </svg>
                </button>
            </div>
        </div>

        <!-- Admin Item Edit Modal -->
        <div id="item-edit-modal" class="fixed inset-0 bg-black/90 backdrop-blur-sm z-50 flex justify-center items-center hidden transition-opacity duration-300">
            <div class="bg-gray-800 p-6 rounded-xl shadow-2xl w-full max-w-lg">
                <h2 class="text-xl font-bold text-red-400 mb-4">ç¼–è¾‘ç½‘æ ¼é¡¹ç›® <span id="item-edit-id" class="text-sm text-gray-400"></span></h2>
                
                <div class="space-y-4 text-white">
                    <div>
                        <label class="block text-sm font-medium text-gray-300">å›¾åƒ URL (Image URL - ç•™ç©ºåˆ™æ˜¾ç¤ºé¢œè‰²)</label>
                        <input id="edit-image-url" type="text" placeholder="https://example.com/image.jpg" class="mt-1 block w-full rounded-md bg-gray-700 border-gray-600 text-white p-2">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-300">è§†é¢‘ URL (Video URL - æ’­æ”¾æ—¶ä½¿ç”¨)</label>
                        <input id="edit-video-url" type="text" placeholder="https://example.com/video.mp4" class="mt-1 block w-full rounded-md bg-gray-700 border-gray-600 text-white p-2">
                    </div>
                </div>

                <div class="flex space-x-4 mt-6">
                    <button class="px-4 py-2 bg-red-600 text-white font-semibold rounded-lg hover:bg-red-700 transition duration-150" onclick="saveItemChanges()">ä¿å­˜é¡¹ç›®</button>
                    <button class="px-4 py-2 bg-gray-500 text-white font-semibold rounded-lg hover:bg-gray-600 transition duration-150" onclick="closeItemEditPanel()">å–æ¶ˆ</button>
                </div>
            </div>
        </div>
        
        <!-- Admin Auth Modal -->
        <div id="auth-modal" class="fixed inset-0 bg-black/90 backdrop-blur-sm z-50 flex justify-center items-center hidden transition-opacity duration-300">
            <div class="bg-gray-800 p-6 rounded-xl shadow-2xl w-full max-w-sm">
                <h2 class="text-xl font-bold text-white mb-4">ç®¡ç†å‘˜ç™»å½•</h2>
                
                <div class="space-y-4 text-white">
                    <div>
                        <label class="block text-sm font-medium text-gray-300">ç”¨æˆ·å</label>
                        <input id="auth-username" type="text" value="admin" class="mt-1 block w-full rounded-md bg-gray-700 border-gray-600 text-white p-2">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-300">å¯†ç </label>
                        <input id="auth-password" type="password" value="1234" class="mt-1 block w-full rounded-md bg-gray-700 border-gray-600 text-white p-2">
                    </div>
                    <p id="auth-error-message" class="text-red-400 text-sm hidden">ç”¨æˆ·åæˆ–å¯†ç é”™è¯¯ã€‚</p>
                </div>

                <div class="flex space-x-4 mt-6">
                    <button class="px-4 py-2 bg-red-600 text-white font-semibold rounded-lg hover:bg-red-700 transition duration-150" onclick="handleAdminLogin()">ç™»å½•</button>
                    <button class="px-4 py-2 bg-gray-500 text-white font-semibold rounded-lg hover:bg-gray-600 transition duration-150" onclick="closeAuthModal()">å–æ¶ˆ</button>
                </div>
            </div>
        </div>

    </div>
</body>
</html>
