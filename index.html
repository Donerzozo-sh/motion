<!DOCTYPE html><html lang="zh-CN"><head>
    <meta charset="UTF-8"/>
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <title id="web-title">çµæ„ŸçŸ©é˜µ | è®¾è®¡ä½œå“é›†</title>
    <!-- å¼•å…¥ Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com  "></script>
    <style>
        /* å¼ºåˆ¶ä½¿ç”¨ Helvetica Now Display å­—ä½“ï¼Œå¹¶æä¾›ç³»ç»Ÿå›é€€ */
        body {
            font-family: 'Helvetica Now Display', 'Helvetica Neue', 'Arial', sans-serif;
            /* éšè—æ»šåŠ¨æ¡ï¼Œæ‰“é€ åº”ç”¨æ„Ÿ */
            overflow: hidden;
            padding-top: 0; 
            background-color: #000;
            min-height: 100vh;
            user-select: none;
        }

        #grid-container {
            cursor: default; 
            /* ä¿æŒè¾ƒå¤§çš„å®¹å™¨å°ºå¯¸ä»¥å…è®¸é±¼çœ¼æ•ˆæœæ”¾å¤§ */
            width: 140vw; 
            height: 140vh;
        }

        .grid-item {
            /* å…³é”®ï¼šç¨å¾®å¢åŠ è¿‡æ¸¡æ—¶é—´ (0.1s -> 0.15s) ä»¥æå‡è§†è§‰å¹³æ»‘æ„Ÿ */
            transition: transform 0.15s cubic-bezier(0.4, 0, 0.2, 1), 
                        opacity 0.15s cubic-bezier(0.4, 0, 0.2, 1),
                        filter 0.15s cubic-bezier(0.4, 0, 0.2, 1);
            
            will-change: transform, opacity, filter;
            opacity: 0.7;
        }
        
        /* ç®¡ç†è¡¨æ ¼ä¸­çš„ç¼©ç•¥å›¾æ ·å¼ */
        .table-thumbnail {
            width: 60px;
            height: 60px;
            object-fit: cover;
            border-radius: 4px;
            border: 1px solid #4B5563;
        }
        
        .admin-table-row {
            transition: background-color 0.15s;
        }

        .admin-table-row:hover {
            background-color: #374151; /* hover:bg-gray-700 */
        }
        
        .selected-row {
            background-color: #EF4444 !important; /* bg-red-500 */
        }

        /* éšè—åŸç”Ÿé¢œè‰²é€‰æ‹©å™¨çš„è¾“å…¥æ¡† */
        input[type="color"]::-webkit-color-swatch-wrapper {
            padding: 0;
        }
        input[type="color"]::-webkit-color-swatch {
            border: none;
            border-radius: 6px;
        }
    </style>
    <!-- å¼•å…¥ Firebase SDK (éœ€è¦ Firestore å’Œ Auth) -->
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js  ";
        import { getAuth, signInAnonymously, signInWithCustomToken, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js  ";
        // å¯¼å…¥ updateDoc ç”¨äºå†…è”ç¼–è¾‘
        import { getFirestore, doc, setDoc, onSnapshot, collection, query, getDocs, setLogLevel, updateDoc } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js  ";

        // ==============================================================================
        // ** ã€ğŸ”¥ğŸ”¥ğŸ”¥ å…³é”®é…ç½®åŒºåŸŸï¼šæ‰‹åŠ¨é…ç½® Firebase Firestore ğŸ”¥ğŸ”¥ğŸ”¥ã€‘ **
        // ==============================================================================
        
        // 1. åº”ç”¨ ID (é‡è¦ï¼šç”¨äºæ„å»º Firestore è·¯å¾„)
        const appId = 'design-c9479'; 

        // 2. Firebase é…ç½®å¯¹è±¡ (å·²æ›¿æ¢ä¸ºæ‚¨çš„çœŸå®é…ç½®)
        const firebaseConfig = {
            apiKey: "AIzaSyDApuOEfnj7x7lg7T-3xceKQMlRvcdJV68",
            authDomain: "design-c9479.firebaseapp.com",
            projectId: "design-c9479",
            storageBucket: "design-c9479.firebasestorage.app",
            messagingSenderId: "779638854632",
            appId: "1:779638854632:web:cd467e5c88cb87c2de0a5d",
            measurementId: "G-RRL6LEV1NV"
        };
        
        // 3. åˆå§‹èº«ä»½éªŒè¯ä»¤ç‰Œ (åœ¨ GitHub Pages/Vercel ç¯å¢ƒä¸­ä¿æŒ null å³å¯ï¼Œå¼ºåˆ¶åŒ¿åç™»å½•)
        const initialAuthToken = null; 
        
        // ==============================================================================
        // ** é…ç½®ç»“æŸ **
        // ==============================================================================

        // --- Firebase & State Variables ---
        let db, auth; 
        let isLocalMode = false;

        // --- DOM å…ƒç´ å£°æ˜ ---
        let gridContainer, modal, videoPlayer, closeModal, mainTitleEl, subTextEl;
        let editContainer, contentDisplay, editTitleEl, editSubtitleEl, topContentArea;
        let editWebTitleEl, editTitleSizeEl, editTitleWeightEl, editTitleColorPickerEl, editTitleSpacingEl;
        let editSubtitleSizeEl, editSubtitleWeightEl, editSubtitleColorPickerEl, editSubtitleSpacingEl;
        let adminToggleBtn, viewToggleBtn;
        let authModal, authUsernameEl, authPasswordEl, authErrorMessageEl, adminTableContainer;
        
        // ** è§†è§‰å‚æ•°ç¼–è¾‘å…ƒç´  **
        let editFisheyeRadiusEl, editDecayPowerEl, editMinScaleEl, editMaxScaleEl;
        let editParallaxSmoothingEl; 
        let editGridGapEl; // ã€æ–°å¢ã€‘ç½‘æ ¼é—´è·å…ƒç´ 


        // --- é…ç½®/çŠ¶æ€å˜é‡ ---
        const NUM_COLS = 10; 
        const NUM_ROWS = 6; 
        const TOTAL_ITEMS = NUM_COLS * NUM_ROWS; // 60
        const PLACEHOLDER_VID = "https://www.w3schools.com/html/mov_bbb.mp4  "; // é»˜è®¤è§†é¢‘å ä½ç¬¦

        // ** åŠ¨æ€äº¤äº’å‚æ•° **
        let currentFisheyeRadius = 300;
        let currentDecayPower = 2.0; // é±¼çœ¼è¡°å‡å¹…åº¦ (æŒ‡æ•°)
        let currentMinScale = 0.175; // åˆå§‹å¤§å°
        let currentMaxScale = 3.0; // æœ€å¤§æ”¾å¤§å€æ•°
        let currentParallaxSmoothing = 0.2; // ã€åŠ¨æ€ã€‘å¹³æ»‘åº¦å‚æ•° (å›æ»šåçš„é»˜è®¤å€¼)
        let currentGridGap = 1; // ã€æ–°å¢ã€‘ç½‘æ ¼é—´è· (px)

        // å›ºå®šçš„è§†å·®å¼ºåº¦
        const PARALLAX_INTENSITY = 0.1; 
        
        // ã€æ–°å¢çŠ¶æ€å˜é‡ã€‘
        window.currentView = 'grid'; // 'grid' | 'table'
        let isAdminMode = false;
        let selectedItemId = null; // å½“å‰åœ¨è¡¨æ ¼ä¸­é€‰ä¸­çš„ Item ID
        let isFocusMode = false; // æ˜¯å¦å¤„äºèšç„¦æ¨¡å¼
        
        // ã€æ–°å¢ã€‘ä¸­å¿ƒè·ç¦»æ’åºæ˜ å°„
        let CENTER_DISTANCE_MAP = { 
            newIdToOriginalIndex: Array.from({ length: TOTAL_ITEMS }, (_, i) => i), // é»˜è®¤åˆå§‹åŒ–
            originalIndexToNewId: Array.from({ length: TOTAL_ITEMS }, (_, i) => i) 
        };


        const DEFAULT_FISHEYE_SETTINGS = {
            radius: 300,
            decayPower: 2.0,
            minScale: 0.175,
            maxScale: 3.0, 
            parallaxSmoothing: 0.2, // å¹³æ»‘åº¦é»˜è®¤å€¼
            gridGap: 1, // ã€æ–°å¢ã€‘é»˜è®¤ç½‘æ ¼é—´è·
        };

        const GRID_COLORS = [
            '#EF4444', '#F97316', '#F59E0B', '#10B981', '#3B82F6', 
            '#6366F1', '#8B5CF6', '#EC4899', '#FBBF24', '#A78BFA', 
            '#4ADE80', '#FB7185', '#D946EF', '#06B6D4', 
        ];

        function getColumnIndex(index) {
            return index % NUM_COLS;
        }

        function getColorForColumn(colIndex) {
            return GRID_COLORS[colIndex % GRID_COLORS.length];
        }


        const DEFAULT_CONTENT = {
            title: "3D&Motion Creative&Production",
            subtitle: "Powerd by REDesign",
            webTitle: "çµæ„ŸçŸ©é˜µ | è®¾è®¡ä½œå“é›†",
            titleStyle: { size: 'text-8xl', weight: 'font-extrabold', color: '#FFFFFF', spacing: 'tracking-normal' },
            subtitleStyle: { size: 'text-2xl', weight: 'font-normal', color: '#9CA3AF', spacing: 'tracking-normal' }
        };

        let items = []; 
        let itemData = {}; 
        let mousePos = { x: 0, y: 0 }; 
        let isMouseActive = false; 
        let animationFrameId = null; 
        let parallaxOffset = { x: 0, y: 0 }; 
        let editingItemId = null; 

        // ä½¿ç”¨ç¡¬ç¼–ç çš„ appId æ¥æ„å»º Firestore è·¯å¾„
        const getSettingsDocPath = (appIdentifier) => `/artifacts/${appIdentifier}/public/data/homepage_content/settings`;
        const getGridCollectionPath = (appIdentifier) => `/artifacts/${appIdentifier}/public/data/grid_items`;


        // --- æ ·å¼è¾…åŠ©å‡½æ•° (ä¿æŒä¸å˜) ---

        function applyTextStyles(element, styleData, isTitle) {
            if (!element) return; 

            const prefixesToClear = [
                'text-', 'font-', 'tracking-' 
            ];
            
            element.className = element.className.split(' ').filter(c => 
                !prefixesToClear.some(prefix => c.startsWith(prefix))
            ).join(' ');

            if (styleData.size) element.classList.add(styleData.size);
            if (styleData.weight) element.classList.add(styleData.weight);
            if (styleData.spacing) element.classList.add(styleData.spacing);
            
            element.style.color = styleData.color || (isTitle ? '#FFFFFF' : '#9CA3AF');

            if (isTitle) {
                element.classList.add('mb-4', 'transition-colors', 'duration-500', 'hover:text-yellow-400', 'cursor-text');
                element.classList.add('md:text-8xl'); 
            } else {
                element.classList.add('transition-colors', 'duration-500', 'hover:text-gray-200', 'cursor-text');
                element.classList.add('md:text-2xl'); 
            }
        }
        
        /**
         * ã€æ–°å¢å‡½æ•°ã€‘è®¡ç®—ç½‘æ ¼ä¸­å¿ƒè·ç¦»æ’åºæ˜ å°„
         * @returns {{newIdToOriginalIndex: number[], originalIndexToNewId: number[]}} æ˜ å°„å¯¹è±¡
         */
        function calculateCenterDistanceMapping() {
            const mapping = [];
            // 10x6 ç½‘æ ¼çš„ä¸­å¿ƒç‚¹ (C, R) æ˜¯ (4.5, 2.5)
            // é¡¹ç›®ä¸­å¿ƒ (C_item, R_item) æ˜¯ (C+0.5, R+0.5)
            // è·ç¦»å¹³æ–¹ D^2 = (4.5 - (C+0.5))^2 + (2.5 - (R+0.5))^2 = (4-C)^2 + (2-R)^2
            const C_TARGET = 4; 
            const R_TARGET = 2; 

            for (let i = 0; i < TOTAL_ITEMS; i++) {
                const C = i % NUM_COLS;
                const R = Math.floor(i / NUM_COLS);

                const D_squared = Math.pow(C_TARGET - C, 2) + Math.pow(R_TARGET - R, 2);

                // Store the original index (spatial index) and its distance score
                mapping.push({ originalIndex: i, distance: D_squared, C, R });
            }

            // Sort by distance (ascending). Distance 0 is the closest (i=24).
            // Use original index as secondary key for stable sorting
            mapping.sort((a, b) => {
                if (a.distance !== b.distance) {
                    return a.distance - b.distance; 
                }
                return a.originalIndex - b.originalIndex; 
            });

            // Create the final index map: new ID -> original index
            const newIdToOriginalIndex = mapping.map(item => item.originalIndex);
            
            // Create the reverse map: original index -> new ID
            const originalIndexToNewId = new Array(TOTAL_ITEMS).fill(0);
            newIdToOriginalIndex.forEach((originalIndex, newId) => {
                originalIndexToNewId[originalIndex] = newId;
            });

            return { newIdToOriginalIndex, originalIndexToNewId };
        }


        /**
         * ã€æ–°å¢å‡½æ•°ã€‘ç”Ÿæˆç½‘æ ¼ä½ç½®ç¼©ç•¥å›¾ HTML
         * @param {number} index - å½“å‰é¡¹ç›®åœ¨ç½‘æ ¼ä¸­çš„åŸå§‹ç©ºé—´ç´¢å¼• (0 to TOTAL_ITEMS - 1).
         * @param {string} highlightColor - ç”¨äºé«˜äº®çš„é¢œè‰² (å³é¡¹ç›®çš„ bgColor).
         * @returns {string} HTML string for the thumbnail grid.
         */
        function renderLocationThumbnail(index, highlightColor) {
            const totalItems = NUM_COLS * NUM_ROWS; 
            // è®¾å®šå›ºå®šçš„å°ºå¯¸ (60px x 45px)ï¼Œgap ä¸º 1px
            let gridHtml = `<div class="w-[60px] h-[45px] grid gap-[1px] bg-gray-900 border border-gray-700 rounded-sm overflow-hidden" 
                                style="grid-template-columns: repeat(${NUM_COLS}, 1fr); grid-template-rows: repeat(${NUM_ROWS}, 1fr);">`;

            for (let i = 0; i < totalItems; i++) {
                // å½“å‰é¡¹ç›®ä½¿ç”¨å…¶è‡ªèº«çš„ bgColorï¼Œå…¶ä»–é¡¹ç›®ä½¿ç”¨æš—ç°è‰² #374151
                const bgColor = i === index ? highlightColor : '#374151'; 
                gridHtml += `<div class="w-full h-full" style="background-color: ${bgColor};"></div>`;
            }

            gridHtml += `</div>`;
            return gridHtml;
        }


        // --- Admin/Auth é€»è¾‘ ---

        window.setAdminMode = (mode) => {
            isAdminMode = mode;
            if (!adminToggleBtn || !topContentArea || !viewToggleBtn) return; 

            // è·å–ç‰ˆæƒä¿¡æ¯ä¸­çš„Â©ç¬¦å·å…ƒç´ 
            const copyrightSymbol = adminToggleBtn.querySelector('span');
            
            if (mode) {
                // ON: é«˜äº®Â©ç¬¦å·ä¸ºçº¢è‰²
                copyrightSymbol.classList.add('text-red-400');
                copyrightSymbol.classList.remove('text-gray-400', 'hover:text-white');
                topContentArea.classList.add('border-b-4', 'border-red-600');
                window.closeAuthModal(); 
                
                // ** è¿›å…¥ç®¡ç†å‘˜æ¨¡å¼æ—¶ï¼Œç«‹å³å¤ä½ç½‘æ ¼ç¼©æ”¾çŠ¶æ€ **
                resetGridScale();
                console.log("Admin Mode activated. Grid scales reset.");
                
                // é»˜è®¤åˆ‡æ¢åˆ°ç½‘æ ¼è§†å›¾ï¼Œå¹¶æ˜¾ç¤ºåˆ‡æ¢æŒ‰é’®
                window.switchView('grid');
                viewToggleBtn.classList.remove('hidden'); // æ˜¾ç¤ºåˆ‡æ¢æŒ‰é’®

            } else {
                // OFF: æ¢å¤Â©ç¬¦å·ä¸ºé»˜è®¤ç°è‰²
                copyrightSymbol.classList.remove('text-red-400');
                copyrightSymbol.classList.add('text-gray-400', 'hover:text-white');
                topContentArea.classList.remove('border-b-4', 'border-red-600');
                viewToggleBtn.classList.add('hidden'); // éšè—åˆ‡æ¢æŒ‰é’®
                console.log("Admin Mode deactivated.");
                
                // ç¡®ä¿è¿”å›ç½‘æ ¼è§†å›¾
                document.getElementById('grid-container').classList.remove('hidden');
                document.getElementById('admin-table-view').classList.add('hidden');
            }
        };
        
        /**
         * åˆ‡æ¢è§†å›¾ï¼šç½‘æ ¼ <-> è¡¨æ ¼
         */
        window.switchView = (view) => {
            if (!isAdminMode) return; 

            window.currentView = view; // ä½¿ç”¨ window.currentView

            const gridEl = document.getElementById('grid-container');
            const tableEl = document.getElementById('admin-table-view');
            const topEditContainer = document.getElementById('edit-mode-container');
            const contentDisplayEl = document.getElementById('content-display');
            const persistentControlsEl = document.getElementById('admin-persistent-controls');

            if (view === 'table') {
                isFocusMode = false; // è¿›å…¥è¡¨æ ¼æ¨¡å¼ï¼Œé€€å‡ºèšç„¦
                gridEl.classList.add('hidden');
                tableEl.classList.remove('hidden');
                renderAdminTable(); // ç”Ÿæˆè¡¨æ ¼å†…å®¹
                
                // éšè—ä¸»æ ‡é¢˜ç¼–è¾‘é¢æ¿å’Œä¸»æ ‡é¢˜æ˜¾ç¤º
                topEditContainer.classList.add('hidden'); 
                contentDisplayEl.classList.add('hidden');
                
                // ç¡®ä¿ç®¡ç†å‘˜æ§åˆ¶æ¡æ˜¾ç¤ºåœ¨æœ€é¡¶å±‚
                persistentControlsEl.classList.remove('z-30');
                persistentControlsEl.classList.add('z-50'); 
                
                viewToggleBtn.textContent = 'è¿”å›ç½‘æ ¼è§†å›¾';
            } else {
                // åˆ‡æ¢å›ç½‘æ ¼è§†å›¾æ—¶ï¼Œé‡ç½®èšç„¦/ç¼©æ”¾
                resetFocusAndScale(); 
                gridEl.classList.remove('hidden');
                tableEl.classList.add('hidden');
                
                // åˆ‡æ¢å›ç½‘æ ¼è§†å›¾æ—¶ï¼Œæ˜¾ç¤ºä¸»æ ‡é¢˜
                contentDisplayEl.classList.remove('hidden');
                window.toggleEditMode(false); // ç¡®ä¿è®¾ç½®é¢æ¿æŠ˜å 
                
                persistentControlsEl.classList.remove('z-50');
                persistentControlsEl.classList.add('z-30');
                
                viewToggleBtn.textContent = 'åˆ‡æ¢åˆ°åˆ—è¡¨ç¼–è¾‘';
            }
        };
        
        /**
         * é‡ç½®èšç„¦å’Œç¼©æ”¾
         */
        function resetFocusAndScale() {
            isFocusMode = false;
            selectedItemId = null;
            resetGridScale(); // å¤ä½ç½‘æ ¼å…ƒç´ å¤§å°
            resetGrid(); // å¤ä½ç½‘æ ¼åç§»
            
            // ç§»é™¤æ‰€æœ‰è¡Œé«˜äº®
            document.querySelectorAll('.admin-table-row').forEach(row => {
                row.classList.remove('selected-row');
            });

            // æ¢å¤é¼ æ ‡åŠ¨ç”»
            isMouseActive = true; 
            startAnimationLoop();
        }


        window.handleAdminToggle = () => {
            if (!adminToggleBtn) return; 
            if (isAdminMode) {
                window.setAdminMode(false);
                resetFocusAndScale(); // é€€å‡ºç®¡ç†å‘˜æ¨¡å¼æ—¶é‡ç½®æ‰€æœ‰çŠ¶æ€
            } else {
                window.openAuthModal();
            }
        };

        window.openAuthModal = () => {
            if (!authModal || !authErrorMessageEl || !authPasswordEl) return; 

            authErrorMessageEl.classList.add('hidden'); 
            // ç§»é™¤è‡ªåŠ¨å¡«å……å¯†ç ï¼Œæ”¹ä¸ºæ¸…ç©º
            authPasswordEl.value = ''; 
            authUsernameEl.value = 'admin'; // ä¿ç•™ç”¨æˆ·åå¡«å……
            authModal.classList.remove('hidden');
        };

        window.closeAuthModal = () => {
            if (!authModal) return; 
            authModal.classList.add('hidden');
        };

        window.handleAdminLogin = () => {
            if (!authUsernameEl || !authPasswordEl || !authErrorMessageEl) return; 

            const username = authUsernameEl.value.trim();
            const password = authPasswordEl.value.trim();
            
            const correctUsername = 'admin';
            const correctPassword = '1234'; 

            if (username === correctUsername && password === correctPassword) {
                window.setAdminMode(true);
            } else {
                authErrorMessageEl.classList.remove('hidden');
                authPasswordEl.value = ''; // ç™»å½•å¤±è´¥æ—¶æ¸…ç©ºå¯†ç 
            }
        };

        /**
         * åˆ‡æ¢ç¼–è¾‘æ¨¡å¼ (é¡¶éƒ¨æ–‡æœ¬ & è§†è§‰å‚æ•°)
         */
        window.toggleEditMode = (enable) => {
            if (!isAdminMode || !editContainer || !contentDisplay || !mainTitleEl || !subTextEl) {
                return; 
            }
            
            if (enable) {
                const titleStyle = mainTitleEl.dataset.style ? JSON.parse(mainTitleEl.dataset.style) : DEFAULT_CONTENT.titleStyle;
                const subtitleStyle = subTextEl.dataset.style ? JSON.parse(subTextEl.dataset.style) : DEFAULT_CONTENT.subtitleStyle;

                // å¡«å……ç½‘ç«™åç§°
                document.getElementById('web-title').textContent = DEFAULT_CONTENT.webTitle; 
                editWebTitleEl.value = document.getElementById('web-title').textContent;

                // å¡«å……æ–‡æœ¬å†…å®¹
                editTitleEl.value = mainTitleEl.textContent;
                editSubtitleEl.value = subTextEl.textContent;

                // å¡«å……ä¸»æ ‡é¢˜æ ·å¼
                editTitleSizeEl.value = titleStyle.size;
                editTitleWeightEl.value = titleStyle.weight;
                editTitleColorPickerEl.value = titleStyle.color;
                editTitleSpacingEl.value = titleStyle.spacing;

                // å¡«å……å‰¯æ ‡é¢˜æ ·å¼
                editSubtitleSizeEl.value = subtitleStyle.size;
                editSubtitleWeightEl.value = subtitleStyle.weight;
                editSubtitleColorPickerEl.value = subtitleStyle.color;
                editSubtitleSpacingEl.value = subtitleStyle.spacing;
                
                // ** å¡«å……è§†è§‰å‚æ•° **
                editFisheyeRadiusEl.value = currentFisheyeRadius;
                editDecayPowerEl.value = currentDecayPower;
                editMinScaleEl.value = currentMinScale;
                editMaxScaleEl.value = currentMaxScale; 
                editParallaxSmoothingEl.value = currentParallaxSmoothing; // å¡«å……å¹³æ»‘åº¦
                editGridGapEl.value = currentGridGap; // ã€æ–°å¢ã€‘å¡«å……ç½‘æ ¼é—´è·
                

                contentDisplay.classList.add('hidden');
                editContainer.classList.remove('hidden');
            } else {
                contentDisplay.classList.remove('hidden');
                editContainer.classList.add('hidden');
            }
        };

        /**
         * ä¿å­˜å†…å®¹åˆ° Firestore (é¡¶éƒ¨æ–‡æœ¬ & è§†è§‰å‚æ•°)
         */
        window.saveContent = async () => {
            if (!editWebTitleEl || !editTitleEl || !editSubtitleEl || !editFisheyeRadiusEl) {
                return console.error("Missing edit elements. Cannot save."); 
            }

            const newWebTitle = editWebTitleEl.value.trim(); 
            const newTitle = editTitleEl.value.trim();
            const newSubtitle = editSubtitleEl.value.trim();

            if (isLocalMode || !db || !appId) return console.error("Firestore is not initialized. Cannot save in local mode. Please check Firebase config.");
            if (!isAdminMode) return console.error("Permission denied. Admin mode required.");

            const docRef = doc(db, getSettingsDocPath(appId));
            
            const newTitleStyle = {
                size: editTitleSizeEl.value,
                weight: editTitleWeightEl.value,
                color: editTitleColorPickerEl.value,
                spacing: editTitleSpacingEl.value,
            };

            const newSubtitleStyle = {
                size: editSubtitleSizeEl.value,
                weight: editSubtitleWeightEl.value,
                color: editSubtitleColorPickerEl.value,
                spacing: editSubtitleSpacingEl.value,
            };
            
            // ** æ”¶é›†æ–°çš„è§†è§‰å‚æ•° (åŒ…æ‹¬å¹³æ»‘åº¦å’Œç½‘æ ¼é—´è·) **
            const newFisheyeSettings = {
                radius: parseFloat(editFisheyeRadiusEl.value) || DEFAULT_FISHEYE_SETTINGS.radius,
                decayPower: parseFloat(editDecayPowerEl.value) || DEFAULT_FISHEYE_SETTINGS.decayPower,
                minScale: parseFloat(editMinScaleEl.value) || DEFAULT_FISHEYE_SETTINGS.minScale,
                maxScale: parseFloat(editMaxScaleEl.value) || DEFAULT_FISHEYE_SETTINGS.maxScale, 
                parallaxSmoothing: parseFloat(editParallaxSmoothingEl.value) || DEFAULT_FISHEYE_SETTINGS.parallaxSmoothing, // æ”¶é›†å¹³æ»‘åº¦
                gridGap: parseInt(editGridGapEl.value) || DEFAULT_FISHEYE_SETTINGS.gridGap, // ã€æ–°å¢ã€‘æ”¶é›†ç½‘æ ¼é—´è·
            };

            try {
                await setDoc(docRef, {
                    webTitle: newWebTitle || DEFAULT_CONTENT.webTitle, 
                    title: newTitle || DEFAULT_CONTENT.title,
                    subtitle: newSubtitle || DEFAULT_CONTENT.subtitle,
                    titleStyle: newTitleStyle,
                    subtitleStyle: newSubtitleStyle,
                    fisheyeSettings: newFisheyeSettings, // ä¿å­˜åŒ…å«å¹³æ»‘åº¦å’Œç½‘æ ¼é—´è·çš„æ–°è§†è§‰å‚æ•°
                    timestamp: new Date()
                });
                console.log("Content and Settings saved successfully.");
                window.toggleEditMode(false);
            } catch (e) {
                console.error("Error saving document: ", e);
            }
        };

        /**
         * æœ¬åœ°å›é€€é€»è¾‘ï¼šå¦‚æœæ— æ³•è¿æ¥ Firebaseï¼Œåˆ™ä½¿ç”¨é»˜è®¤æ•°æ®å¹¶ç«‹å³æ¸²æŸ“ã€‚
         */
        window.runLocalFallback = () => {
            if (!mainTitleEl || !subTextEl || !gridContainer) {
                 console.error("Critical DOM elements not found for fallback.");
                 return;
            }
            isLocalMode = true;
            console.warn("Firebase connection failed. Running in Local Mode (Read-Only) with default data.");
            
            // ç«‹å³åº”ç”¨é»˜è®¤å†…å®¹
            document.title = DEFAULT_CONTENT.webTitle; 
            mainTitleEl.textContent = DEFAULT_CONTENT.title;
            subTextEl.textContent = DEFAULT_CONTENT.subtitle;
            applyTextStyles(mainTitleEl, DEFAULT_CONTENT.titleStyle, true);
            applyTextStyles(subTextEl, DEFAULT_CONTENT.subtitleStyle, false);
            
            // åº”ç”¨é»˜è®¤è§†è§‰å‚æ•°
            currentFisheyeRadius = DEFAULT_FISHEYE_SETTINGS.radius;
            currentDecayPower = DEFAULT_FISHEYE_SETTINGS.decayPower;
            currentMinScale = DEFAULT_FISHEYE_SETTINGS.minScale;
            currentMaxScale = DEFAULT_FISHEYE_SETTINGS.maxScale;
            currentParallaxSmoothing = DEFAULT_FISHEYE_SETTINGS.parallaxSmoothing; // åº”ç”¨é»˜è®¤å¹³æ»‘åº¦
            currentGridGap = DEFAULT_FISHEYE_SETTINGS.gridGap; // åº”ç”¨é»˜è®¤ç½‘æ ¼é—´è·

            // åˆå§‹åŒ–ä¸­å¿ƒè·ç¦»æ˜ å°„
            CENTER_DISTANCE_MAP = calculateCenterDistanceMapping();

            // åˆå§‹åŒ–ç½‘æ ¼æ•°æ®å¹¶æ¸²æŸ“
            initializeDefaultGridData(); 
            createGrid(); 
            startAnimationLoop(); 
            window.setAdminMode(false); // ç¡®ä¿åœ¨å›é€€æ¨¡å¼ä¸‹ä¹Ÿåº”ç”¨æ­£ç¡®çš„æŒ‰é’®æ ·å¼
        };


        /**
         * ç›‘å¬ Firestore ä¸Šçš„å†…å®¹å˜åŒ–
         */
        window.setupContentListener = (firestore, appIdentifier) => {
            if (!mainTitleEl || !subTextEl) return; 
            
            const docRef = doc(firestore, getSettingsDocPath(appIdentifier)); 

            onSnapshot(docRef, (docSnap) => {
                let data = {};
                if (docSnap.exists()) {
                    data = docSnap.data();
                }

                // --- 1. æ›´æ–°é¡¶éƒ¨æ–‡æœ¬å’Œæ ·å¼ ---
                const currentWebTitle = data.webTitle || DEFAULT_CONTENT.webTitle; 
                const currentTitle = data.title || DEFAULT_CONTENT.title;
                const currentSubtitle = data.subtitle || DEFAULT_CONTENT.subtitle;
                const currentTitleStyle = data.titleStyle || DEFAULT_CONTENT.titleStyle;
                const currentSubtitleStyle = data.subtitleStyle || DEFAULT_CONTENT.subtitleStyle;

                document.title = currentWebTitle; 
                mainTitleEl.textContent = currentTitle;
                subTextEl.textContent = currentSubtitle;

                applyTextStyles(mainTitleEl, currentTitleStyle, true);
                applyTextStyles(subTextEl, currentSubtitleStyle, false);

                mainTitleEl.dataset.style = JSON.stringify(currentTitleStyle);
                subTextEl.dataset.style = JSON.stringify(currentSubtitleStyle);

                // --- 2. æ›´æ–°è§†è§‰å‚æ•° ---
                const settings = data.fisheyeSettings || DEFAULT_FISHEYE_SETTINGS;
                currentFisheyeRadius = settings.radius;
                currentDecayPower = settings.decayPower;
                currentMinScale = settings.minScale;
                currentMaxScale = settings.maxScale || DEFAULT_FISHEYE_SETTINGS.maxScale; 
                currentParallaxSmoothing = settings.parallaxSmoothing || DEFAULT_FISHEYE_SETTINGS.parallaxSmoothing; // æ›´æ–°å¹³æ»‘åº¦
                currentGridGap = settings.gridGap || DEFAULT_FISHEYE_SETTINGS.gridGap; // ã€æ–°å¢ã€‘æ›´æ–°ç½‘æ ¼é—´è·
                
                // ç¡®ä¿ç½‘æ ¼æ›´æ–°åˆå§‹å¤§å°å’Œé—´è·
                updateGridDOM();

            }, (error) => {
                console.error("Error listening to content:", error);
            });
        };

        /**
         * ç›‘å¬ Firestore ä¸Šçš„ç½‘æ ¼é¡¹ç›®å˜åŒ–
         */
        window.setupGridListener = (firestore, appIdentifier) => {
            if (!gridContainer) return; 
            
            const colRef = collection(firestore, getGridCollectionPath(appIdentifier)); 

            onSnapshot(colRef, (snapshot) => {
                let initialLoad = Object.keys(itemData).length === 0;
                
                const newItemsFromFirestore = {};
                snapshot.docChanges().forEach(change => {
                    const data = change.doc.data();
                    const itemId = change.doc.id;
                    const i = parseInt(itemId.split('_')[1]); // åŸå§‹ç©ºé—´ç´¢å¼•
                    
                    // æ£€æŸ¥ç´¢å¼•æ˜¯å¦åœ¨æ–°èŒƒå›´å†… (0-59)
                    if (i >= TOTAL_ITEMS) return; 
                    
                    const colIndex = getColumnIndex(i);
                    const defaultColor = getColorForColumn(colIndex);

                    newItemsFromFirestore[itemId] = {
                        img: data.img || null, 
                        vid: data.vid || PLACEHOLDER_VID,
                        bgColor: data.bgColor || defaultColor 
                    };
                });
                
                // å¡«å……æ‰€æœ‰ç¼ºå¤±çš„é¡¹ç›®ï¼Œç¡®ä¿ itemData æ€»æ˜¯åŒ…å« TOTAL_ITEMS (60) ä¸ªé”®
                for (let i = 0; i < TOTAL_ITEMS; i++) {
                    const itemId = `item_${i}`;
                    const colIndex = getColumnIndex(i);
                    const defaultColor = getColorForColumn(colIndex);
                    
                    if (!newItemsFromFirestore[itemId]) {
                        // ä½¿ç”¨ç°æœ‰æ•°æ®æˆ–é»˜è®¤æ•°æ®è¿›è¡Œå¡«å……
                        newItemsFromFirestore[itemId] = itemData[itemId] || {
                            img: null,
                            vid: PLACEHOLDER_VID,
                            bgColor: defaultColor
                        };
                    }
                }
                itemData = newItemsFromFirestore;


                if (initialLoad) {
                    createGrid();
                } else {
                    updateGridDOM();
                }
            }, async (error) => {
                console.error("Error listening to grid items:", error);
                if (Object.keys(itemData).length === 0) {
                    await initializeDefaultGridData();
                    createGrid();
                }
            });
        };
        
        /**
         * åˆå§‹åŒ–é»˜è®¤ç½‘æ ¼æ•°æ® (æœ¬åœ°æ¨¡å¼ä¸‹ä¸å†™å…¥ DB)
         */
        async function initializeDefaultGridData() {
            if (!gridContainer) return; 

            if (isLocalMode) {
                for (let i = 0; i < TOTAL_ITEMS; i++) {
                    const itemId = `item_${i}`;
                    const colIndex = getColumnIndex(i);
                    itemData[itemId] = {
                        img: null,
                        vid: PLACEHOLDER_VID,
                        bgColor: getColorForColumn(colIndex)
                    };
                }
                return; 
            }

            if (!db || !appId) return console.error("Firestore DB/App ID not ready for default initialization.");

            const colRef = collection(db, getGridCollectionPath(appId));
            const snapshot = await getDocs(colRef);

            if (snapshot.empty) {
                console.log("No existing grid data. Initializing default items.");
                for (let i = 0; i < TOTAL_ITEMS; i++) {
                    const itemId = `item_${i}`;
                    const colIndex = getColumnIndex(i);
                    const defaultColor = getColorForColumn(colIndex);

                    itemData[itemId] = {
                        img: null, 
                        vid: PLACEHOLDER_VID,
                        bgColor: defaultColor
                    };
                    // åªå†™å…¥å‰ 5 ä¸ªä½œä¸ºç¤ºä¾‹
                    if (i < 5) { 
                        // ä½¿ç”¨ setDoc åˆ›å»º/æ›´æ–°æ–‡æ¡£
                        await setDoc(doc(db, getGridCollectionPath(appId), itemId), itemData[itemId]);
                    }
                }
            } else {
                 // å¦‚æœå­˜åœ¨æ•°æ®ï¼Œä½†æ•°é‡ä¸è¶³ TOTAL_ITEMSï¼Œç¡®ä¿ itemData å®Œæ•´
                 snapshot.docs.forEach(doc => {
                    const data = doc.data();
                    const i = parseInt(doc.id.split('_')[1]); // åŸå§‹ç©ºé—´ç´¢å¼•
                    // å¿½ç•¥è¶…å‡ºæ–° TOTAL_ITEMS èŒƒå›´çš„é¡¹ç›®
                    if (i >= TOTAL_ITEMS) return; 
                    
                    const colIndex = getColumnIndex(i);
                    const defaultColor = getColorForColumn(colIndex);

                    itemData[doc.id] = {
                        img: data.img || null,
                        vid: data.vid || PLACEHOLDER_VID,
                        bgColor: data.bgColor || defaultColor
                    };
                });
                // å¡«å……ç¼ºå¤±çš„éƒ¨åˆ†
                for (let i = 0; i < TOTAL_ITEMS; i++) {
                    const itemId = `item_${i}`;
                    if (!itemData[itemId]) {
                         const colIndex = getColumnIndex(i);
                         itemData[itemId] = { img: null, vid: PLACEHOLDER_VID, bgColor: getColorForColumn(colIndex) };
                    }
                }
            }
        }
        
        function createGrid() {
            if (items.length > 0 || !gridContainer) return; 
            
            gridContainer.innerHTML = ''; 
            // ç½‘æ ¼ç»“æ„ä¿æŒä¸å˜ï¼ˆ10x6ï¼‰
            gridContainer.style.gridTemplateColumns = `repeat(${NUM_COLS}, 1fr)`;
            // ã€æ–°å¢ã€‘è®¾ç½®ç½‘æ ¼é—´è·
            gridContainer.style.gap = `${currentGridGap}px`;

            for (let i = 0; i < TOTAL_ITEMS; i++) {
                // i æ˜¯åŸå§‹çš„ç©ºé—´ç´¢å¼• (0-59, ä»å·¦ä¸Šè§’å¼€å§‹)
                const itemId = `item_${i}`;
                const data = itemData[itemId] || { // ç¡®ä¿æœ‰é»˜è®¤æ•°æ®
                    img: null,
                    vid: PLACEHOLDER_VID,
                    bgColor: getColorForColumn(getColumnIndex(i))
                };

                const item = document.createElement('div');
                item.className = 'grid-item aspect-square bg-cover bg-center cursor-pointer';
                
                // åº”ç”¨æ•°æ® (é¢œè‰²/å›¾ç‰‡)
                if (data.img && data.img.trim()) {
                    item.style.backgroundImage = `url(${data.img})`;
                    item.style.backgroundColor = 'transparent';
                } else {
                    item.style.backgroundImage = 'none';
                    item.style.backgroundColor = data.bgColor;
                }

                // ** åº”ç”¨åŠ¨æ€åˆå§‹å¤§å° **
                item.style.transform = `scale(${currentMinScale})`; 
                item.style.opacity = '0.7'; 

                // ä½¿ç”¨åŸå§‹ç©ºé—´ç´¢å¼•ä½œä¸º data-id
                item.dataset.videoId = itemId;
                
                gridContainer.appendChild(item);
                
                item.twinklePhase = Math.random() * 2 * Math.PI;
                item.twinkleSpeed = 0.5 + Math.random() * 0.5;

                items.push({ 
                    el: item, 
                    center: { x: 0, y: 0 },
                    twinklePhase: item.twinklePhase,
                    twinkleSpeed: item.twinkleSpeed
                });
            }
            
            cacheItemPositions();
        }

        function updateGridDOM() {
            if (items.length === 0 || !gridContainer) return; 

            // ã€æ–°å¢ã€‘æ›´æ–°ç½‘æ ¼é—´è·
            gridContainer.style.gap = `${currentGridGap}px`;

            for(let i = 0; i < items.length; i++) {
                const itemId = `item_${i}`; // åŸå§‹ç©ºé—´ç´¢å¼• ID
                const data = itemData[itemId] || { // ç¡®ä¿æœ‰é»˜è®¤æ•°æ®
                    img: null,
                    vid: PLACEHOLDER_VID,
                    bgColor: getColorForColumn(getColumnIndex(i))
                };
                const itemEl = items[i].el;
                
                if (data.img && data.img.trim()) {
                    itemEl.style.backgroundImage = `url(${data.img})`;
                    itemEl.style.backgroundColor = 'transparent';
                } else {
                    itemEl.style.backgroundImage = 'none';
                    itemEl.style.backgroundColor = data.bgColor;
                }
                
                // ** åœ¨æ›´æ–°æ—¶åº”ç”¨æ–°çš„åˆå§‹å¤§å°ï¼ˆå¦‚æœç½‘æ ¼å·²ç»åˆ›å»ºï¼‰ **
                if (!itemEl.style.transform.includes('scale(') || itemEl.style.transform.includes('scale(0.')) {
                     // ä»…åœ¨å…ƒç´ æœªè¢«é±¼çœ¼æ”¾å¤§æ—¶åº”ç”¨åˆå§‹å¤§å°
                    itemEl.style.transform = `scale(${currentMinScale})`;
                }
            }
        }
        
        /**
         * ã€æ–°å¢å‡½æ•°ã€‘å†…è”ä¿å­˜é¡¹ç›®æ›´æ”¹
         * itemId æ˜¯åŸå§‹ç©ºé—´ ID (item_i)
         */
        window.saveInlineItemChange = async (itemId, imgInputId, vidInputId, saveButton) => {
            const imgInput = document.getElementById(imgInputId);
            const vidInput = document.getElementById(vidInputId);

            if (!imgInput || !vidInput) return console.error("Missing input elements for saving.");

            const newImg = imgInput.value.trim();
            const newVid = vidInput.value.trim();

            if (isLocalMode || !db || !appId) return console.error("Invalid state for saving. Cannot save in local mode.");
            if (!isAdminMode) return console.error("Permission denied. Admin mode required.");

            // ç¦ç”¨æŒ‰é’®å¹¶æ˜¾ç¤ºåŠ è½½ä¸­çŠ¶æ€
            saveButton.disabled = true;
            saveButton.textContent = 'ä¿å­˜ä¸­...';
            saveButton.classList.remove('bg-red-600', 'hover:bg-red-700', 'bg-green-600', 'hover:bg-green-700');
            saveButton.classList.add('bg-gray-500');

            const itemIndex = parseInt(itemId.split('_')[1]); // åŸå§‹ç©ºé—´ç´¢å¼• i
            const colIndex = getColumnIndex(itemIndex);
            const defaultColor = getColorForColumn(colIndex);

            const dataToSave = { 
                vid: newVid,
                bgColor: itemData[itemId]?.bgColor || defaultColor, 
                img: newImg || null,
            };

            const docRef = doc(db, getGridCollectionPath(appId), itemId);

            try {
                await updateDoc(docRef, dataToSave); 
                console.log(`Item ${itemId} updated successfully.`);
                
                // æ›´æ–°æœ¬åœ° itemData
                itemData[itemId] = { ...itemData[itemId], ...dataToSave };
                
                // æ¢å¤æŒ‰é’®çŠ¶æ€
                saveButton.textContent = 'ä¿å­˜';
                saveButton.classList.remove('bg-gray-500');
                saveButton.classList.add('bg-green-600', 'hover:bg-green-700');
                
                // é‡æ–°æ¸²æŸ“è¡¨æ ¼ä»¥æ›´æ–°é¢„è§ˆå›¾
                renderAdminTable(); 

            } catch (e) {
                console.error("Error saving grid item: ", e);
                saveButton.textContent = 'ä¿å­˜å¤±è´¥';
                saveButton.classList.remove('bg-gray-500', 'bg-green-600', 'hover:bg-green-700');
                saveButton.classList.add('bg-red-600', 'hover:bg-red-700');
            } finally {
                 saveButton.disabled = false;
            }
        };

        /**
         * ã€æ–°å¢å‡½æ•°ã€‘èšç„¦åˆ°é€‰å®šçš„ç½‘æ ¼é¡¹ç›®
         * itemId æ˜¯åŸå§‹ç©ºé—´ ID (item_i)
         */
        window.selectItem = (itemId, rowElement) => {
            if (!isAdminMode) return; 

            // 1. é«˜äº®è¡¨æ ¼è¡Œ
            document.querySelectorAll('.admin-table-row').forEach(row => {
                row.classList.remove('selected-row');
            });
            rowElement.classList.add('selected-row');
            
            selectedItemId = itemId; 
            isFocusMode = true; 
            isMouseActive = true; 
            startAnimationLoop(); 

            // 2. å±…ä¸­è®¡ç®—
            const item = items.find(i => i.el.dataset.videoId === itemId);
            if (!item) return;

            const viewportCenterX = window.innerWidth / 2;
            const viewportCenterY = window.innerHeight / 2;
            
            // è®¡ç®—éœ€è¦å°†é¡¹ç›®ä¸­å¿ƒç§»åŠ¨åˆ°è§†å£ä¸­å¿ƒæ‰€éœ€çš„åç§»é‡
            // T_x = V_x - C_x
            const targetX = viewportCenterX - item.center.x;
            const targetY = viewportCenterY - item.center.y;
            
            // ç«‹å³è®¾ç½®åç§»ç›®æ ‡ï¼ŒåŠ¨ç”»å¾ªç¯ä¼šå¹³æ»‘è¿‡æ¸¡
            parallaxOffset.x = targetX;
            parallaxOffset.y = targetY;
            applyGridTransform(); // ç«‹å³åº”ç”¨ä¸€æ¬¡ä»¥å‡å°‘å»¶è¿Ÿ
        };


        /**
         * æ¸²æŸ“ç®¡ç†å‘˜ç´ æç¼–è¾‘è¡¨æ ¼
         */
        function renderAdminTable() {
            if (!adminTableContainer) return; 

            let tableHtml = `
                <div class="overflow-x-auto h-[80vh] bg-gray-900/90 backdrop-blur-sm rounded-xl shadow-2xl p-4">
                    <table class="min-w-full divide-y divide-gray-700">
                        <thead class="sticky top-0 bg-gray-900/95">
                            <tr>
                                <!-- æ ‡é¢˜æ”¹ä¸º ID (ä¸­å¿ƒè·ç¦») -->
                                <th class="px-3 py-3 text-left text-xs font-medium text-gray-300 uppercase tracking-wider w-16">ID (ä¸­å¿ƒè·ç¦»)</th>
                                <th class="px-3 py-3 text-left text-xs font-medium text-gray-300 uppercase tracking-wider w-20">é¢„è§ˆ</th>
                                <!-- æ–°å¢ä½ç½®ç¼©ç•¥å›¾åˆ— -->
                                <th class="px-3 py-3 text-left text-xs font-medium text-gray-300 uppercase tracking-wider w-24">ä½ç½®</th>
                                <th class="px-3 py-3 text-left text-xs font-medium text-gray-300 uppercase tracking-wider">å›¾ç‰‡ URL (Image)</th>
                                <th class="px-3 py-3 text-left text-xs font-medium text-gray-300 uppercase tracking-wider">è§†é¢‘ URL (Video)</th>
                                <th class="px-3 py-3 text-left text-xs font-medium text-gray-300 uppercase tracking-wider w-24">æ“ä½œ</th>
                            </tr>
                        </thead>
                        <tbody class="divide-y divide-gray-800">
            `;

            // ã€å…³é”®æ›´æ”¹ã€‘ï¼šæ ¹æ®ä¸­å¿ƒè·ç¦»æ’åºçš„æ˜ å°„æ¥æ¸²æŸ“è¡¨æ ¼è¡Œ
            for (let newId = 0; newId < TOTAL_ITEMS; newId++) {
                // originalIndex æ˜¯ç½‘æ ¼çš„ç‰©ç†ä½ç½®ç´¢å¼• (0-59)
                const originalIndex = CENTER_DISTANCE_MAP.newIdToOriginalIndex[newId];
                const itemId = `item_${originalIndex}`; // Firestore/DOM ID

                const data = itemData[itemId] || { 
                    img: '', 
                    vid: PLACEHOLDER_VID, 
                    bgColor: getColorForColumn(getColumnIndex(originalIndex)) 
                };
                
                const imgUrl = data.img || '';
                const videoUrl = data.vid || '';
                const displayImg = imgUrl.trim() || `https://placehold.co/60x60/  ${data.bgColor.substring(1)}/FFFFFF?text=${originalIndex}`;
                
                const isSelected = selectedItemId === itemId ? 'selected-row' : '';

                tableHtml += `
                    <tr id="row-${itemId}" class="admin-table-row text-gray-300 cursor-pointer ${isSelected}" 
                        data-item-id="${itemId}" onclick="selectItem('${itemId}', this)">
                        <!-- æ˜¾ç¤ºæ–°çš„ä¸­å¿ƒè·ç¦» ID (newId) -->
                        <td class="px-3 py-2 whitespace-nowrap text-sm font-medium">${newId}</td> 
                        <td class="px-3 py-2 whitespace-nowrap">
                            <img src="${displayImg}" class="table-thumbnail" onerror="this.onerror=null; this.src='https://placehold.co/60x60/374151/FFFFFF?text=  ${originalIndex}'" alt="Item ${originalIndex} Preview">
                        </td>
                        <!-- ä½ç½®ç¼©ç•¥å›¾ä¾ç„¶ä½¿ç”¨åŸå§‹ç©ºé—´ç´¢å¼• originalIndex -->
                        <td class="px-3 py-2">
                            ${renderLocationThumbnail(originalIndex, data.bgColor)} 
                        </td>
                        <td class="px-3 py-2 text-sm max-w-sm">
                            <input id="img-input-${itemId}" type="text" value="${imgUrl}" placeholder="Image URL" 
                                class="w-full text-xs rounded-md bg-gray-700 border-gray-600 text-white p-1 focus:ring-red-500 focus:border-red-500">
                        </td>
                        <td class="px-3 py-2 text-sm max-w-sm">
                            <input id="vid-input-${itemId}" type="text" value="${videoUrl}" placeholder="Video URL" 
                                class="w-full text-xs rounded-md bg-gray-700 border-gray-600 text-white p-1 focus:ring-red-500 focus:border-red-500">
                        </td>
                        <td class="px-3 py-2 whitespace-nowrap text-sm">
                            <button class="px-3 py-1 bg-red-600 text-white font-semibold rounded-lg hover:bg-red-700 transition duration-150" 
                                onclick="event.stopPropagation(); saveInlineItemChange('${itemId}', 'img-input-${itemId}', 'vid-input-${itemId}', this);">
                                ä¿å­˜
                            </button>
                        </td>
                    </tr>
                `;
            }

            tableHtml += `
                        </tbody>
                    </table>
                </div>
            `;
            adminTableContainer.innerHTML = tableHtml;
        }


        /**
         * 1. è·å–æ‰€æœ‰ DOM å…ƒç´ çš„å¼•ç”¨
         * 2. ç»‘å®šæ‰€æœ‰äº‹ä»¶ç›‘å¬å™¨
         */
        function setupDOMAndListeners() {
            // --- 1. DOM å…ƒç´ è·å– ---
            gridContainer = document.getElementById('grid-container');
            modal = document.getElementById('video-modal');
            videoPlayer = document.getElementById('video-player');
            closeModal = document.getElementById('close-modal');
            mainTitleEl = document.getElementById('main-title');
            subTextEl = document.getElementById('sub-text');
            editContainer = document.getElementById('edit-mode-container');
            contentDisplay = document.getElementById('content-display');
            editTitleEl = document.getElementById('edit-title');
            editSubtitleEl = document.getElementById('edit-subtitle');
            topContentArea = document.getElementById('top-content-area');
            adminTableContainer = document.getElementById('admin-table-view'); // æ–°å¢è¡¨æ ¼å®¹å™¨

            // Admin Text Edit Elements
            editWebTitleEl = document.getElementById('edit-web-title'); 
            editTitleSizeEl = document.getElementById('edit-title-size');
            editTitleWeightEl = document.getElementById('edit-title-weight');
            editTitleColorPickerEl = document.getElementById('edit-title-color-picker');
            editTitleSpacingEl = document.getElementById('edit-title-spacing');
            editSubtitleSizeEl = document.getElementById('edit-subtitle-size');
            editSubtitleWeightEl = document.getElementById('edit-subtitle-weight');
            editSubtitleColorPickerEl = document.getElementById('edit-subtitle-color-picker');
            editSubtitleSpacingEl = document.getElementById('edit-subtitle-spacing');

            // ** è§†è§‰å‚æ•°å…ƒç´  **
            editFisheyeRadiusEl = document.getElementById('edit-fisheye-radius');
            editDecayPowerEl = document.getElementById('edit-decay-power');
            editMinScaleEl = document.getElementById('edit-min-scale');
            editMaxScaleEl = document.getElementById('edit-max-scale'); 
            editParallaxSmoothingEl = document.getElementById('edit-parallax-smoothing'); // å¹³æ»‘åº¦å…ƒç´ 
            editGridGapEl = document.getElementById('edit-grid-gap'); // ã€æ–°å¢ã€‘ç½‘æ ¼é—´è·å…ƒç´ 


            // Admin UI elements
            adminToggleBtn = document.getElementById('admin-toggle-btn');
            viewToggleBtn = document.getElementById('view-toggle-btn'); // è§†å›¾åˆ‡æ¢æŒ‰é’®

            // Auth UI elements
            authModal = document.getElementById('auth-modal');
            authUsernameEl = document.getElementById('auth-username');
            authPasswordEl = document.getElementById('auth-password');
            authErrorMessageEl = document.getElementById('auth-error-message');
            
            // --- 2. ç»‘å®šäº‹ä»¶ç›‘å¬å™¨ ---

            window.addEventListener('mousemove', (e) => {
                // åªæœ‰åœ¨ç½‘æ ¼è§†å›¾ä¸”éèšç„¦æ¨¡å¼æ—¶æ‰æ›´æ–°é¼ æ ‡ä½ç½®
                if (window.currentView === 'grid' || isFocusMode === false) { 
                    mousePos.x = e.clientX;
                    mousePos.y = e.clientY;

                    if (!isMouseActive) {
                        isMouseActive = true;
                        startAnimationLoop();
                    }
                }
            });

            window.addEventListener('mouseenter', () => {
                 if (window.currentView === 'grid' && !isMouseActive && isFocusMode === false) { 
                    isMouseActive = true;
                    startAnimationLoop();
                }
            });

            window.addEventListener('mouseleave', () => {
                if (isFocusMode === false) {
                    isMouseActive = false;
                    resetGrid(); 
                }
            });

            gridContainer.addEventListener('click', (e) => {
                const itemElement = e.target.closest('.grid-item');
                if (itemElement) {
                    const itemId = itemElement.dataset.videoId; // åŸå§‹ç©ºé—´ ID (item_i)
                    
                    if (isAdminMode) {
                        // åœ¨ç½‘æ ¼è§†å›¾ä¸‹ç‚¹å‡»é¡¹ç›®ï¼Œç›´æ¥åˆ‡æ¢åˆ°è¡¨æ ¼å¹¶é€‰ä¸­è¯¥é¡¹ç›®
                        window.switchView('table');
                        const rowElement = document.getElementById(`row-${itemId}`);
                        if (rowElement) {
                             window.selectItem(itemId, rowElement);
                             rowElement.scrollIntoView({ behavior: 'smooth', block: 'center' });
                        }
                        return; 
                    }

                    isMouseActive = false; 
                    const videoSrc = itemData[itemId]?.vid || PLACEHOLDER_VID;
                    openVideoModal(videoSrc);
                }
            });

            closeModal.addEventListener('click', closeVideoModalFunc);
            modal.addEventListener('click', (e) => {
                if (e.target === modal) {
                    closeVideoModalFunc();
                }
            });

            let resizeTimer;
            window.addEventListener('resize', () => {
                clearTimeout(resizeTimer);
                resizeTimer = setTimeout(() => {
                    cacheItemPositions();
                    // å¦‚æœåœ¨èšç„¦æ¨¡å¼ï¼Œé‡æ–°è®¡ç®—å±…ä¸­
                    if(isFocusMode && selectedItemId) {
                         const rowElement = document.getElementById(`row-${selectedItemId}`);
                         if(rowElement) window.selectItem(selectedItemId, rowElement); // é‡æ–°è§¦å‘å±…ä¸­è®¡ç®—
                    }
                }, 100);
            });

            window.addEventListener('contextmenu', (e) => {
                if (e.button === 1) {
                    e.preventDefault();
                }
            });
            
            // åˆå§‹åŒ– Admin Mode æ ·å¼ (é»˜è®¤å…³é—­)
            window.setAdminMode(false); 
        }


        /**
         * å¯åŠ¨åº”ç”¨ï¼ˆåˆå§‹åŒ– Firebase & ç›‘å¬å™¨ï¼‰
         */
        window.setupApp = async () => {
            
            setupDOMAndListeners();
            
            // ã€æ–°å¢ã€‘åœ¨åˆå§‹åŒ–æ—¶è®¡ç®—ä¸€æ¬¡ä¸­å¿ƒè·ç¦»æ˜ å°„
            CENTER_DISTANCE_MAP = calculateCenterDistanceMapping();

            const hasFirebaseConfig = Object.keys(firebaseConfig).length > 0 && firebaseConfig.apiKey.includes('AIzaSyD'); 

            if (!hasFirebaseConfig) {
                window.runLocalFallback();
                return;
            }

            try {
                const app = initializeApp(firebaseConfig);
                db = getFirestore(app);
                auth = getAuth(app);
                
                setLogLevel('error'); 

                let authSuccess = false;
                if (initialAuthToken) {
                    await signInWithCustomToken(auth, initialAuthToken).then(() => { authSuccess = true; }).catch(e => { console.error("Custom token sign-in failed (ignored for GH Pages):", e); });
                }
                
                if (!authSuccess) {
                    try {
                        await signInAnonymously(auth);
                        authSuccess = true;
                    } catch (e) {
                        console.error("Anonymous sign-in failed:", e);
                        window.runLocalFallback();
                        return;
                    }
                }
                
                const unsubscribe = onAuthStateChanged(auth, (user) => { 
                    if (user) {
                        console.log("User state confirmed. Setting up Firestore listeners.");
                        // ä½¿ç”¨æ–°çš„è®¾ç½®æ–‡æ¡£è·¯å¾„
                        window.setupContentListener(db, appId);
                        window.setupGridListener(db, appId);
                        unsubscribe();
                    } else {
                        console.warn("User is not logged in. Waiting for sign-in state.");
                    }
                }, (error) => {
                     console.error("onAuthStateChanged error:", error);
                     window.runLocalFallback();
                });
                
            } catch (error) {
                console.error("Firebase Initialization/Sign-In Error, falling back:", error);
                window.runLocalFallback();
            }
        };

        window.addEventListener('load', window.setupApp);

        // --- æ ¸å¿ƒåŠ¨ç”»/äº¤äº’å‡½æ•° (ä½¿ç”¨åŠ¨æ€å‚æ•° & åŠ é€Ÿ) ---

        function cacheItemPositions() {
            if (!gridContainer) return; 
            
            const oldTransform = gridContainer.style.transform;
            gridContainer.style.transform = ''; 

            for (const item of items) {
                const rect = item.el.getBoundingClientRect();
                item.center = {
                    x: rect.left + rect.width / 2,
                    y: rect.top + rect.height / 2
                };
            }

            gridContainer.style.transform = oldTransform;
        }

        function applyGridTransform() {
            if (!gridContainer) return; 

            const finalX = parallaxOffset.x;
            const finalY = parallaxOffset.y;
            // ä½¿ç”¨ translate3d æå‡ GPU æ¸²æŸ“æ€§èƒ½
            gridContainer.style.transform = `translate3d(${finalX}px, ${finalY}px, 0)`; 
        }

        /**
         * ã€æ–°å¢å‡½æ•°ã€‘å°†æ‰€æœ‰ç½‘æ ¼å…ƒç´ å¤ä½åˆ°åˆå§‹å¤§å°ã€‚
         */
        function resetGridScale() {
            if (items.length === 0) return; 
            
            // ä½¿ç”¨åŠ¨æ€åˆå§‹å¤§å°è¿›è¡Œå¤ä½
            for (const item of items) {
                item.el.style.transform = `scale(${currentMinScale})`;
                item.el.style.opacity = '0.7';
                item.el.style.zIndex = 1;
                item.el.style.filter = 'brightness(1.0)'; 
            }
        }

        function updateFisheyeEffect() {
            if (!gridContainer) { 
                 animationFrameId = null;
                 return;
            }
            
            // --- 1. è§†å·®åç§»è®¡ç®—ä¸åº”ç”¨ (ä½¿ç”¨åŠ¨æ€å¹³æ»‘åº¦) ---
            const viewportCenterX = window.innerWidth / 2;
            const viewportCenterY = window.innerHeight / 2;
            
            if (!isFocusMode) {
                 // æ­£å¸¸æ¨¡å¼ä¸‹ï¼Œè®¡ç®—åŸºäºé¼ æ ‡çš„è§†å·®ç›®æ ‡
                const targetParallaxX = (mousePos.x - viewportCenterX) * PARALLAX_INTENSITY;
                const targetParallaxY = (mousePos.y - viewportCenterY) * PARALLAX_INTENSITY;
                
                // ä½¿ç”¨åŠ¨æ€å¹³æ»‘ç³»æ•° currentParallaxSmoothing è¿›è¡Œå¹³æ»‘è¿‡æ¸¡
                parallaxOffset.x += (targetParallaxX - parallaxOffset.x) * currentParallaxSmoothing;
                parallaxOffset.y += (targetParallaxY - parallaxOffset.y) * currentParallaxSmoothing;
            } else {
                // èšç„¦æ¨¡å¼ä¸‹ï¼Œè®¡ç®—åŸºäºç›®æ ‡çš„å¹³æ»‘è¿‡æ¸¡
                const item = items.find(i => i.el.dataset.videoId === selectedItemId);
                if (item) {
                    const targetX = viewportCenterX - item.center.x;
                    const targetY = viewportCenterY - item.center.y;

                    // ä½¿ç”¨æ›´æ…¢çš„å¹³æ»‘åº¦å®ç°å¹³æ»‘çš„å±…ä¸­åŠ¨ç”»
                    const FOCUS_SMOOTHING = 0.05; 
                    parallaxOffset.x += (targetX - parallaxOffset.x) * FOCUS_SMOOTHING;
                    parallaxOffset.y += (targetY - parallaxOffset.y) * FOCUS_SMOOTHING;
                }
            }
            
            applyGridTransform(); 

            if (isAdminMode && window.currentView === 'table') { 
                // è¡¨æ ¼è§†å›¾ä¸‹ï¼Œåªæ‰§è¡Œè§†å·®/èšç„¦å¹³ç§»ï¼Œä¸æ‰§è¡Œé±¼çœ¼å’Œé—ªçƒæ•ˆæœ
                animationFrameId = requestAnimationFrame(updateFisheyeEffect); // ä¿æŒåŠ¨ç”»å¾ªç¯è¿è¡Œ
                return;
            } else if (isAdminMode) {
                // ç®¡ç†å‘˜ç½‘æ ¼æ¨¡å¼ä¸‹ï¼Œåªæ‰§è¡Œè§†å·®ï¼Œä¸æ‰§è¡Œé±¼çœ¼å’Œé—ªçƒæ•ˆæœ
                animationFrameId = requestAnimationFrame(updateFisheyeEffect);
                return;
            }

            // --- 2. é±¼çœ¼/èšç„¦æ•ˆæœè®¡ç®— ---
            const fisheyeCenterX = mousePos.x;
            const fisheyeCenterY = mousePos.y;
            // åŠ¨æ€è¯»å–é…ç½®å‚æ•°
            const fisheyeRadius = currentFisheyeRadius;
            const minScale = currentMinScale;
            const decayPower = currentDecayPower;
            const maxScale = currentMaxScale; 

            // èšç„¦æ¨¡å¼ä¸‹ï¼Œä½¿ç”¨æ›´å¤§çš„ç¼©æ”¾ç›®æ ‡
            const focusScale = maxScale * 1.5; 

            for (const item of items) {
                const adjustedItemCenterX = item.center.x + parallaxOffset.x; 
                const adjustedItemCenterY = item.center.y + parallaxOffset.y; 

                let scale;
                let opacity;
                let zIndex = 1;
                let brightness = 1.0; 
                
                // ã€èšç„¦æ¨¡å¼è¦†ç›–ã€‘
                if (isFocusMode && item.el.dataset.videoId === selectedItemId) {
                    scale = focusScale; // æ”¾å¤§åˆ°æœ€å¤§ç¼©æ”¾
                    opacity = 1.0;
                    zIndex = 100; // ç¡®ä¿åœ¨æœ€å‰é¢
                    brightness = 1.0; 
                } else if (isFocusMode) {
                    // éé€‰ä¸­é¡¹
                    scale = minScale * 0.5; // ç¼©å°éé€‰ä¸­é¡¹
                    opacity = 0.2;
                    zIndex = 1;
                    brightness = 0.5;
                } else {
                    // ã€æ­£å¸¸é±¼çœ¼æ¨¡å¼ã€‘
                    const dx = fisheyeCenterX - adjustedItemCenterX;
                    const dy = fisheyeCenterY - adjustedItemCenterY;
                    const dist = Math.sqrt(dx * dx + dy * dy);

                    if (dist >= fisheyeRadius) { 
                        
                        opacity = 0.7;
                        
                        // --- 3. é—ªçƒæ•ˆæœ (Twinkling: äº®åº¦ + å¤§å°) ---
                        item.twinklePhase += (0.02 + Math.random() * 0.01) * item.twinkleSpeed;
                        const sineVal = (Math.sin(item.twinklePhase) + 1) / 2;
                        
                        const minBrightness = 0.2; 
                        const maxBrightness = 1.4; 
                        const brightnessRange = maxBrightness - minBrightness; 
                        brightness = minBrightness + (brightnessRange * sineVal);
                        
                        const minTwinkleScale = minScale * 0.70; 
                        const maxTwinkleScale = minScale * 1.30; 
                        const scaleRange = maxTwinkleScale - minTwinkleScale;
                        
                        const sineTwinkleScale = (Math.sin(item.twinklePhase) + 1) / 2; 
                        scale = minTwinkleScale + (scaleRange * sineTwinkleScale); 
                        
                    } else {
                        // é±¼çœ¼æ•ˆæœåŒºåŸŸ
                        const proximity = 1 - (dist / fisheyeRadius);
                        
                        const easedProximity = 1 - Math.pow(1 - proximity, decayPower); 
                        
                        scale = minScale + (maxScale - minScale) * easedProximity;
                        opacity = 0.7 + (1.0 - 0.7) * easedProximity;
                        
                        zIndex = 2 + Math.floor(proximity * 8); 
                        brightness = 1.0; 
                    }
                }

                item.el.style.transform = `translateZ(0) scale(${scale})`;
                item.el.style.opacity = opacity;
                item.el.style.zIndex = zIndex;
                item.el.style.filter = `brightness(${brightness})`;
            }
            
            if (isMouseActive) { 
                animationFrameId = requestAnimationFrame(updateFisheyeEffect);
            } else {
                animationFrameId = null; 
            }
        }

        function startAnimationLoop() {
            if (!gridContainer) return; 
            if (!animationFrameId) {
                animationFrameId = requestAnimationFrame(updateFisheyeEffect);
            }
        }

        function resetGrid() {
            if (items.length === 0 || !gridContainer) return; 

            // è°ƒç”¨æ–°çš„å¤ä½å‡½æ•°
            resetGridScale(); 

            parallaxOffset = { x: 0, y: 0 };
            applyGridTransform(); 
        }

        function openVideoModal(videoSrc) {
            if (!modal || !videoPlayer) return; 

            videoPlayer.src = videoSrc;
            modal.classList.remove('hidden');
            videoPlayer.play().catch(e => {
                if (e.name !== 'AbortError') {
                    console.error("è§†é¢‘æ’­æ”¾å¤±è´¥:", e);
                }
            });
        }

        function closeVideoModalFunc() {
            if (!modal || !videoPlayer) return; 

            modal.classList.add('hidden');
            videoPlayer.pause();
            videoPlayer.src = ''; 
            // ä»è§†é¢‘æ’­æ”¾è¿”å›ï¼Œé‡ç½®èšç„¦æ¨¡å¼
            resetFocusAndScale(); 
            isMouseActive = true; 
            startAnimationLoop();
        }

    </script>

        <!-- é¡¶éƒ¨å†…å®¹åŒºåŸŸ/ç¼–è¾‘æ¨¡å¼ -->
        <div id="top-content-area" class="fixed top-0 left-0 right-0 p-8 md:p-12 z-20 text-white pointer-events-none transition-all duration-300">
            
            <!-- ã€ä¿®å¤ã€‘æ–°å¢ç‹¬ç«‹æ§åˆ¶æ¡ï¼Œç¡®ä¿åˆ‡æ¢æŒ‰é’®å§‹ç»ˆå¯è§ -->
            <div id="admin-persistent-controls" class="absolute top-8 right-8 md:top-12 md:right-12 z-30 flex space-x-4 pointer-events-auto">
                <!-- è§†å›¾åˆ‡æ¢æŒ‰é’® -->
                <button id="view-toggle-btn" class="px-4 py-2 bg-blue-600 text-white font-semibold rounded-lg hover:bg-blue-700 transition duration-150 hidden" onclick="switchView(window.currentView === &#39;grid&#39; ? &#39;table&#39; : &#39;grid&#39;)">
                    åˆ‡æ¢åˆ°åˆ—è¡¨ç¼–è¾‘
                </button>
            </div>
            
            <div id="content-display" class="flex flex-col">
                <h1 id="main-title" class="text-white text-4xl font-extrabold cursor-text transition-colors duration-500 hover:text-yellow-400 pointer-events-auto" onclick="toggleEditMode(true)">3D&amp;Motion Creative&amp;Production</h1>
                <p id="sub-text" class="text-gray-400 text-base font-normal cursor-text transition-colors duration-500 hover:text-gray-200 pointer-events-auto" onclick="toggleEditMode(true)">Powerd by REDesign</p>
            </div>

            <!-- ç¼–è¾‘æ¨¡å¼ UI (Admin Only) -->
            <div id="edit-mode-container" class="hidden bg-gray-900/90 backdrop-blur-sm p-6 rounded-xl shadow-2xl pointer-events-auto max-w-4xl">
                <h2 class="text-xl font-bold mb-4 text-red-400">é¡¶éƒ¨å†…å®¹åŠè§†è§‰å‚æ•°ç¼–è¾‘ (Admin)</h2>
                
                <div class="space-y-4">
                    <!-- Web Title -->
                    <div>
                        <label class="block text-sm font-medium text-gray-400">ç½‘ç«™æ ‡é¢˜ (Title)</label>
                        <input id="edit-web-title" type="text" class="mt-1 block w-full rounded-md bg-gray-700 border-gray-600 text-white p-2" value="çµæ„ŸçŸ©é˜µ | è®¾è®¡ä½œå“é›†"/>
                    </div>
                    
                    <!-- ä¸»æ ‡é¢˜å’Œå‰¯æ ‡é¢˜ç¼–è¾‘ - å·¦å³æ’åˆ— -->
                    <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                        <!-- Main Title Edit -->
                        <div class="p-4 bg-gray-800 rounded-lg">
                            <label class="block text-lg font-medium text-white mb-2">ä¸»æ ‡é¢˜</label>
                            <input id="edit-title" type="text" class="mt-1 block w-full rounded-md bg-gray-700 border-gray-600 text-white p-2" value="3D&amp;Motion Creative&amp;Production"/>
                            <div class="grid grid-cols-2 gap-3 mt-3 text-sm">
                                <select id="edit-title-size" class="rounded-md bg-gray-700 border-gray-600 text-white p-2">
                                    <option value="text-8xl">ç‰¹å¤§å·</option>
                                    <option value="text-6xl">å¤§å·</option>
                                    <option value="text-4xl">ä¸­å·</option>
                                </select>
                                <select id="edit-title-weight" class="rounded-md bg-gray-700 border-gray-600 text-white p-2">
                                    <option value="font-extrabold">æç²—</option>
                                    <option value="font-bold">ç²—ä½“</option>
                                    <option value="font-semibold">åŠç²—</option>
                                </select>
                                <input id="edit-title-color-picker" type="color" class="h-10 w-full rounded-md bg-gray-700 border-gray-600 p-1 cursor-pointer" value="#FFFFFF"/>
                                <select id="edit-title-spacing" class="rounded-md bg-gray-700 border-gray-600 text-white p-2">
                                    <option value="tracking-normal">é»˜è®¤é—´è·</option>
                                    <option value="tracking-wider">æ›´å®½</option>
                                    <option value="tracking-tight">æ›´ç´§</option>
                                </select>
                            </div>
                        </div>

                        <!-- Subtitle Edit -->
                        <div class="p-4 bg-gray-800 rounded-lg">
                            <label class="block text-lg font-medium text-white mb-2">å‰¯æ ‡é¢˜</label>
                            <input id="edit-subtitle" type="text" class="mt-1 block w-full rounded-md bg-gray-700 border-gray-600 text-white p-2" value="Powerd by REDesign"/>
                            <div class="grid grid-cols-2 gap-3 mt-3 text-sm">
                                <select id="edit-subtitle-size" class="rounded-md bg-gray-700 border-gray-600 text-white p-2">
                                    <option value="text-2xl">å¤§å·</option>
                                    <option value="text-xl">ä¸­å·</option>
                                    <option value="text-base">å°å·</option>
                                </select>
                                <select id="edit-subtitle-weight" class="rounded-md bg-gray-700 border-gray-600 text-white p-2">
                                    <option value="font-normal">é»˜è®¤</option>
                                    <option value="font-bold">ç²—ä½“</option>
                                    <option value="font-extrabold">æç²—</option>
                                </select>
                                <input id="edit-subtitle-color-picker" type="color" class="h-10 w-full rounded-md bg-gray-700 border-gray-600 p-1 cursor-pointer" value="#9CA3AF"/>
                                <select id="edit-subtitle-spacing" class="rounded-md bg-gray-700 border-gray-600 text-white p-2">
                                    <option value="tracking-normal">é»˜è®¤é—´è·</option>
                                    <option value="tracking-widest">æœ€å®½</option>
                                    <option value="tracking-tight">æ›´ç´§</option>
                                </select>
                            </div>
                        </div>
                    </div>
                    
                    <!-- ç½‘æ ¼è§†è§‰å‚æ•°ç¼–è¾‘ - è°ƒæ•´ä¸ºå“åº”å¼ 6 åˆ—å¸ƒå±€ -->
                    <div class="p-4 bg-gray-800 rounded-lg">
                        <label class="block text-lg font-medium text-white mb-4">ç½‘æ ¼è§†è§‰å‚æ•°</label>
                        <!-- è°ƒæ•´ä¸º md:grid-cols-3 lg:grid-cols-6 ä»¥å®¹çº³ 6 ä¸ªå…ƒç´  -->
                        <div class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-6 gap-3">
                            <div>
                                <label class="block text-sm font-medium text-gray-400">é±¼çœ¼åŠå¾„ (px)</label>
                                <input id="edit-fisheye-radius" type="number" step="10" min="100" max="1000" class="mt-1 block w-full rounded-md bg-gray-700 border-gray-600 text-white p-2" value="300"/>
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-400">è¡°å‡å¹…åº¦ (1.0 - 5.0)</label>
                                <input id="edit-decay-power" type="number" step="0.1" min="1.0" max="5.0" class="mt-1 block w-full rounded-md bg-gray-700 border-gray-600 text-white p-2" value="2.0"/>
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-400">åˆå§‹å¤§å° (0.01 - 1.0)</label>
                                <input id="edit-min-scale" type="number" step="0.01" min="0.01" max="1.0" class="mt-1 block w-full rounded-md bg-gray-700 border-gray-600 text-white p-2" value="0.175"/>
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-400">æœ€å¤§æ”¾å¤§å€æ•°</label>
                                <input id="edit-max-scale" type="number" step="0.1" min="1.0" max="5.0" class="mt-1 block w-full rounded-md bg-gray-700 border-gray-600 text-white p-2" value="3.0"/>
                            </div>
                            <!-- åŠ¨ç”»å¹³æ»‘åº¦è°ƒèŠ‚ -->
                            <div>
                                <label class="block text-sm font-medium text-gray-400">åŠ¨ç”»å¹³æ»‘åº¦ (0.01 - 1.0)</label>
                                <input id="edit-parallax-smoothing" type="number" step="0.01" min="0.01" max="1.0" class="mt-1 block w-full rounded-md bg-gray-700 border-gray-600 text-white p-2" value="0.2"/>
                            </div>
                            <!-- ç½‘æ ¼é—´è·è°ƒèŠ‚ -->
                            <div>
                                <label class="block text-sm font-medium text-gray-400">å›¾ç‰‡é—´è· (px)</label>
                                <input id="edit-grid-gap" type="number" step="1" min="0" max="20" class="mt-1 block w-full rounded-md bg-gray-700 border-gray-600 text-white p-2" value="1"/>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="flex space-x-4 mt-6">
                    <button class="px-4 py-2 bg-red-600 text-white font-semibold rounded-lg hover:bg-red-700 transition duration-150" onclick="saveContent()">ä¿å­˜æ›´æ”¹</button>
                    <button class="px-4 py-2 bg-gray-500 text-white font-semibold rounded-lg hover:bg-gray-600 transition duration-150" onclick="toggleEditMode(false)">å–æ¶ˆ</button>
                </div>
            </div>
        </div>
        
        <!-- ç®¡ç†å‘˜è¡¨æ ¼è§†å›¾å®¹å™¨ (æ–°å¢) -->
        <div id="admin-table-view" class="fixed inset-0 p-4 md:p-12 z-10 hidden overflow-auto pointer-events-auto">
            <h1 class="text-3xl font-bold mb-4 text-red-400">ç½‘æ ¼ç´ æåˆ—è¡¨ç¼–è¾‘ (å…± ${TOTAL_ITEMS} ä¸ªé¡¹ç›®)</h1>
            <!-- è¡¨æ ¼å†…å®¹å°†ç”± JavaScript å¡«å…… -->
        </div>


        <!-- ç‰ˆæƒä¿¡æ¯å’Œç®¡ç†å‘˜æ¨¡å¼è§¦å‘å™¨ -->
        <div id="admin-toggle-btn" class="fixed bottom-4 right-4 z-50 text-gray-400 text-sm font-medium pointer-events-auto cursor-default">
            2025 <span class="cursor-pointer hover:text-white transition-colors duration-200" onclick="handleAdminToggle()">Â©</span> All Rights Reserved By REDesign
        </div>


        <!-- ç½‘æ ¼å®¹å™¨ (ä½äºä¸­å¿ƒ) -->
        <div id="grid-container" class="absolute inset-0 m-auto grid" style="transform: translate(0, 0); transform-style: preserve-3d;">
            <!-- Grid items will be generated here by JavaScript -->
        </div>

        <!-- è§†é¢‘æ¨¡æ€æ¡† (ç”¨äºæ’­æ”¾é€‰ä¸­çš„é¡¹ç›®) -->
        <div id="video-modal" class="fixed inset-0 bg-black/90 backdrop-blur-sm z-50 flex justify-center items-center hidden transition-opacity duration-300">
            <div class="relative w-full max-w-4xl h-auto aspect-video rounded-xl shadow-2xl overflow-hidden">
                <video id="video-player" class="w-full h-full object-cover" controls="" autoplay="" playsinline=""></video>
                <button id="close-modal" class="absolute top-4 right-4 text-white p-2 rounded-full bg-black/50 hover:bg-black/80 transition" aria-label="Close video">
                    <svg xmlns="http://www.w3.org/2000/svg  " class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                    </svg>
                </button>
            </div>
        </div>

        <!-- Admin Auth Modal -->
        <div id="auth-modal" class="fixed inset-0 bg-black/90 backdrop-blur-sm z-50 flex justify-center items-center hidden transition-opacity duration-300">
            <div class="bg-gray-800 p-8 rounded-xl shadow-2xl w-full max-w-md border border-gray-700">
                <h2 class="text-2xl font-bold text-white mb-6 text-center">ç®¡ç†å‘˜ç™»å½•</h2>
                
                <div class="space-y-5 text-white">
                    <div>
                        <label class="block text-sm font-medium text-gray-300 mb-2">ç”¨æˆ·å</label>
                        <input id="auth-username" type="text" value="admin" class="block w-full rounded-md bg-gray-700 border border-gray-600 text-white p-3 focus:ring-2 focus:ring-red-500 focus:border-red-500"/>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-300 mb-2">å¯†ç </label>
                        <input id="auth-password" type="password" value="" class="block w-full rounded-md bg-gray-700 border border-gray-600 text-white p-3 focus:ring-2 focus:ring-red-500 focus:border-red-500" placeholder="è¯·è¾“å…¥å¯†ç "/>
                    </div>
                    <p id="auth-error-message" class="text-red-400 text-sm hidden text-center">ç”¨æˆ·åæˆ–å¯†ç é”™è¯¯ã€‚</p>
                </div>

                <div class="flex space-x-4 mt-8">
                    <button class="flex-1 py-3 bg-red-600 text-white font-semibold rounded-lg hover:bg-red-700 transition duration-150 focus:outline-none focus:ring-2 focus:ring-red-500" onclick="handleAdminLogin()">ç™»å½•</button>
                    <button class="flex-1 py-3 bg-gray-600 text-white font-semibold rounded-lg hover:bg-gray-700 transition duration-150 focus:outline-none focus:ring-2 focus:ring-gray-500" onclick="closeAuthModal()">å–æ¶ˆ</button>
                </div>
            </div>
        </div>
        <!-- item-edit-modal å·²è¢«ç§»é™¤ -->
    </div>

</body></html>
